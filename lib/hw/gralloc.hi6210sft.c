/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2015 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

signed int __fastcall alloc_device_open(int a1, int a2, int *a3, int a4);
int __fastcall framebuffer_device_open(int a1, int a2, _DWORD *a3);
// int _android_log_print(_DWORD, _DWORD, const char *, ...); weak
int __fastcall gralloc_backend_invalidate(int result, int a2, int a3);
int __fastcall gralloc_backend_sync(int a1, int a2, int a3);
// int __fastcall sync_wait(_DWORD, _DWORD); weak
// int close(int fd);
// __pid_t getpid(void);
// int pthread_mutex_lock(pthread_mutex_t *mutex);
int __fastcall gralloc_backend_unregister(int result);
// int pthread_mutex_unlock(pthread_mutex_t *mutex);
int __fastcall gralloc_backend_register(int a1, int a2);
// void *memset(void *s, int c, size_t n);
// int pthread_mutex_init(pthread_mutex_t *mutex, const pthread_mutexattr_t *mutexattr);
int __fastcall private_module_t::private_module_t(private_module_t *this);
void *__fastcall alloc_backend_alloc_free(int a1, int a2);
// void __cdecl operator delete(void *); idb
int __fastcall gralloc_specific_convert_format(int result, int a2);
unsigned int *__fastcall gralloc_specific_calc_size_stride(int a1, int a2, int a3, int a4, unsigned int *a5, unsigned int *a6, int *a7);
unsigned int *__fastcall gralloc_specific_calc_special_size(int a1, int a2, int a3, int a4, unsigned int a5, unsigned int *a6, unsigned int *a7);
unsigned int __fastcall gralloc_specific_align(int a1, int a2);
signed int __fastcall alloc_backend_alloc(unsigned int a1, int a2, int a3, size_t a4, int a5, int *a6);
int __fastcall gralloc_specific_set_yuvinfo(int result, int a2);
// _DWORD __cdecl operator new(unsigned int); idb
signed int __fastcall alloc_backend_open(int a1, int a2, int a3);
signed int __fastcall gralloc_specific_select_heap(int a1, bool a2);
unsigned int __fastcall gralloc_specific_change_ionflags_size(unsigned int result, int a2, unsigned int *a3, unsigned int *a4);
// int __fastcall ion_alloc(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int __fastcall ion_map_iommu(_DWORD, _DWORD, _DWORD); weak
// int __fastcall ion_free(_DWORD, _DWORD); weak
// int __fastcall ion_share(_DWORD, _DWORD, _DWORD); weak
// int __fastcall ion_unmap_iommu(_DWORD, _DWORD, _DWORD); weak
// int __fastcall ion_get_phys(_DWORD, _DWORD, _DWORD); weak
// void *mmap(void *addr, size_t len, int prot, int flags, int fd, __off_t offset);
int __fastcall gralloc_specific_clear_buffer(int a1, int a2);
// int ioctl(int fd, unsigned __int32 request, ...);
// int munmap(void *addr, size_t len);
// int __fastcall ion_open(_DWORD); weak
// int __fastcall _errno(_DWORD); weak
// char *strerror(int errnum);
int __fastcall gralloc_specific_get_default_ionheap(private_module_t *a1);
// int __fastcall ion_close(_DWORD); weak
// int ion_sync_fd(void); weak
int __fastcall gralloc_backend_cache_op(int a1, int a2, int a3);
// int ion_invalidate_fd(void); weak
// void glFinish(void);
signed int __fastcall gralloc_specific_fb_post(int a1, int a2);
// int snprintf(char *s, size_t maxlen, const char *format, ...);
// int open(const char *file, int oflag, ...);
// void *memcpy(void *dest, const void *src, size_t n);
// int dup(int fd);
// int __fastcall _stack_chk_fail(_DWORD); weak
int __fastcall init_frame_buffer_locked(private_module_t *a1, int a2, int a3);
// void abort(void);
// int fprintf(FILE *stream, const char *format, ...);
// int __fastcall _aeabi_memcpy(_DWORD); weak
// int __fastcall _aeabi_memset(_DWORD, _DWORD, _DWORD); weak
// int dladdr(void); weak
// int __fastcall _snprintf_chk(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int __fastcall _gnu_Unwind_Find_exidx(_DWORD, _DWORD); weak
signed int __fastcall sub_17BC(int a1);
signed int __fastcall sub_17EC(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8);
int __fastcall sub_1894(int a1, int a2, int a3);
int __fastcall sub_18E8(int a1, int a2, _DWORD *a3);
signed int __fastcall sub_192C(int a1, int a2, int a3, int a4, int a5, int a6, int a7, _DWORD *a8);
signed int __fastcall sub_19E4(int a1, int a2, int a3, int a4, int a5, int a6, int a7, _DWORD *a8, int a9);
int __fastcall sub_1A38(int a1, int a2, int a3, int a4);
signed int __fastcall sub_1B60(int a1, int a2, int a3, int a4);
int __fastcall private_module_t::private_module_t(int a1);
signed int __fastcall sub_1D5C(int a1, int a2, int a3);
signed int __fastcall sub_1E1C(unsigned int a1, unsigned int a2, int a3, int a4, int a5, int *a6, unsigned int *a7);
signed int __fastcall alloc_device_open(int a1, int a2, int *a3, int a4);
signed int __fastcall alloc_backend_alloc(unsigned int a1, int a2, int a3, size_t a4, int a5, int *a6);
signed int __fastcall alloc_backend_alloc_framebuffer(int a1, int a2);
void *__fastcall alloc_backend_alloc_free(int a1, int a2);
signed int __fastcall alloc_backend_open(int a1, int a2, int a3);
int __fastcall alloc_backend_close(int a1);
int __fastcall gralloc_backend_register(int a1, int a2);
int __fastcall gralloc_backend_unregister(int result);
int __fastcall gralloc_backend_cache_op(int a1, int a2, int a3);
int __fastcall gralloc_backend_sync(int a1, int a2, int a3);
int __fastcall gralloc_backend_invalidate(int result, int a2, int a3);
int sub_2BCC(); // weak
int compositionComplete();
int __fastcall sub_2BF0(int a1, int a2);
int __fastcall sub_2DA0(void *a1);
int __fastcall sub_2DAC(int a1);
int __fastcall init_frame_buffer_locked(private_module_t *a1, int a2, int a3);
int __fastcall framebuffer_device_open(int a1, int a2, _DWORD *a3);
signed int __fastcall gralloc_specific_fb_post(int a1, int a2);
int __fastcall gralloc_specific_convert_format(int result, int a2);
unsigned int *__fastcall gralloc_specific_calc_size_stride(int a1, int a2, int a3, int a4, unsigned int *a5, unsigned int *a6, int *a7);
unsigned int *__fastcall gralloc_specific_calc_special_size(int a1, int a2, int a3, int a4, unsigned int a5, unsigned int *a6, unsigned int *a7);
signed int __fastcall gralloc_specific_select_heap(int a1, bool a2);
unsigned int __fastcall gralloc_specific_align(int a1, int a2);
unsigned int __fastcall gralloc_specific_change_ionflags_size(unsigned int result, int a2, unsigned int *a3, unsigned int *a4);
int __fastcall gralloc_specific_set_yuvinfo(int result, int a2);
int __fastcall gralloc_specific_get_default_ionheap(private_module_t *a1);
int __fastcall gralloc_specific_clear_buffer(int a1, int a2);
signed int __fastcall sub_35B8(int a1, int a2, unsigned int a3, unsigned int a4);
signed int __fastcall sub_38FC(int a1, int a2, unsigned int a3, int a4, int *a5);
signed int __fastcall sub_39A0(int a1, int a2, unsigned int a3, int a4);
signed int __fastcall sub_3AC4(int a1, int a2, int a3);
void sub_3B18();
void sub_3B20();
signed int __fastcall sub_3BBC(int a1, int a2, char a3);
void __fastcall sub_3CD4(int a1, int a2, int a3);
int __fastcall sub_3D58(int a1, int a2, int a3, int a4, int a5);
int __fastcall sub_3D70(int _R0);
int __fastcall sub_3D78(int _R0);
int __fastcall sub_3D80(int _R0);
void sub_3D88();
void sub_3DCC();
int __fastcall sub_3DE0(int a1);
signed int __fastcall sub_3E30(int a1, int a2, _DWORD *a3);
signed int __fastcall sub_3E60(int a1, int a2, int a3);
signed int __fastcall sub_3EA4(int a1, int a2, _QWORD *a3);
signed int __fastcall sub_3ED4(int a1, int a2, int a3, int a4);
int __fastcall sub_3F0C(int a1);
signed int __fastcall sub_3F14(int a1, int a2);
signed int __fastcall sub_3F34(int a1);
int __fastcall sub_3F4C(int a1);
int __fastcall sub_3F5C(int a1, int a2);
int __fastcall sub_3F80(int a1, signed int a2);
int __fastcall sub_401C(int result, signed int a2, int a3);
int __fastcall sub_40B4(int a1, int a2);
__int64 __fastcall sub_40D8(int a1, int a2);
int __fastcall sub_4188(int a1, int a2, int a3, int a4);
signed int __fastcall sub_425C(int a1);
int __fastcall sub_42A8(int a1, int a2);
void __fastcall sub_42E8(int a1);
int __fastcall sub_4300(int a1);
signed int __fastcall sub_4308(int a1, int a2, int a3, _DWORD *a4);
int __fastcall sub_4364(int a1, int a2);
const char *__fastcall sub_43B0(int a1, signed int a2);
int __fastcall sub_43B8(int result);
void __fastcall sub_43C0(int a1, int a2, int a3, int a4);
int __fastcall sub_43F4(int a1);
int sub_4444(); // weak
int __fastcall sub_45D4(int result, int a2, int a3, _DWORD *a4, int a5, int a6, int a7, _DWORD *a8);
int sub_4CAC(); // weak
int __fastcall sub_4CC0(int _R0);
int __fastcall sub_4CC8(int _R0);
int __fastcall sub_4CD0(int _R0);
int __fastcall sub_4CD8(_DWORD *a1);
int __fastcall sub_4D1C(_DWORD *a1);
void *j_j_memset(void *s, int c, size_t n);
void *j_memset(void *s, int c, size_t n);
int j_j_ion_sync_fd();
int j_ion_sync_fd();
int __fastcall j_j_j__Z24gralloc_backend_cache_opP16private_handle_tij(int a1, int a2, int a3);
int __fastcall j_gralloc_backend_cache_op(int a1, int a2, int a3);
int j_j_ion_invalidate_fd();
int j_ion_invalidate_fd();
void sub_4DA0();
void sub_4DA4();
int __fastcall sub_4DB0(_DWORD *a1);
int __fastcall sub_4DB4(_DWORD *a1);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_3ACC; // weak
void *off_7D3C = (void *)0x3F55; // weak
int GLOBAL_OFFSET_TABLE_ = 0; // weak
void *off_8004 = (void *)0x1771; // weak
char *off_8008[2] = { "/dev/graphics/fb%u", "/dev/fb%u" }; // weak
char *off_800C = "/dev/fb%u"; // weak
_UNKNOWN unk_8010; // weak
_UNKNOWN unk_8014; // weak
char byte_81D8; // weak
int dword_81DC; // weak
_UNKNOWN unk_81E0; // weak
// extern _UNKNOWN _stack_chk_guard; weak
// extern struct _IO_FILE *stderr;


//----- (000013B0) --------------------------------------------------------
signed int __fastcall alloc_device_open(int a1, int a2, int *a3, int a4)
{
  return alloc_device_open(a1, a2, a3, a4);
}

//----- (000013BC) --------------------------------------------------------
int __fastcall framebuffer_device_open(int a1, int a2, _DWORD *a3)
{
  return framebuffer_device_open(a1, a2, a3);
}

//----- (000013D4) --------------------------------------------------------
int __fastcall gralloc_backend_invalidate(int result, int a2, int a3)
{
  return gralloc_backend_invalidate(result, a2, a3);
}

//----- (000013E0) --------------------------------------------------------
int __fastcall gralloc_backend_sync(int a1, int a2, int a3)
{
  return gralloc_backend_sync(a1, a2, a3);
}

//----- (0000141C) --------------------------------------------------------
int __fastcall gralloc_backend_unregister(int result)
{
  return gralloc_backend_unregister(result);
}

//----- (00001434) --------------------------------------------------------
int __fastcall gralloc_backend_register(int a1, int a2)
{
  return gralloc_backend_register(a1, a2);
}

//----- (00001458) --------------------------------------------------------
int __fastcall private_module_t::private_module_t(private_module_t *this)
{
  return private_module_t::private_module_t((int)this);
}

//----- (00001464) --------------------------------------------------------
void *__fastcall alloc_backend_alloc_free(int a1, int a2)
{
  return alloc_backend_alloc_free(a1, a2);
}

//----- (0000147C) --------------------------------------------------------
int __fastcall gralloc_specific_convert_format(int result, int a2)
{
  return gralloc_specific_convert_format(result, a2);
}

//----- (00001488) --------------------------------------------------------
unsigned int *__fastcall gralloc_specific_calc_size_stride(int a1, int a2, int a3, int a4, unsigned int *a5, unsigned int *a6, int *a7)
{
  return gralloc_specific_calc_size_stride(a1, a2, a3, a4, a5, a6, a7);
}

//----- (00001494) --------------------------------------------------------
unsigned int *__fastcall gralloc_specific_calc_special_size(int a1, int a2, int a3, int a4, unsigned int a5, unsigned int *a6, unsigned int *a7)
{
  return gralloc_specific_calc_special_size(a1, a2, a3, a4, a5, a6, a7);
}

//----- (000014A0) --------------------------------------------------------
unsigned int __fastcall gralloc_specific_align(int a1, int a2)
{
  return gralloc_specific_align(a1, a2);
}

//----- (000014AC) --------------------------------------------------------
signed int __fastcall alloc_backend_alloc(unsigned int a1, int a2, int a3, size_t a4, int a5, int *a6)
{
  return alloc_backend_alloc(a1, a2, a3, a4, a5, a6);
}

//----- (000014B8) --------------------------------------------------------
int __fastcall gralloc_specific_set_yuvinfo(int result, int a2)
{
  return gralloc_specific_set_yuvinfo(result, a2);
}

//----- (000014D0) --------------------------------------------------------
signed int __fastcall alloc_backend_open(int a1, int a2, int a3)
{
  return alloc_backend_open(a1, a2, a3);
}

//----- (000014DC) --------------------------------------------------------
signed int __fastcall gralloc_specific_select_heap(int a1, bool a2)
{
  return gralloc_specific_select_heap(a1, a2);
}

//----- (000014E8) --------------------------------------------------------
unsigned int __fastcall gralloc_specific_change_ionflags_size(unsigned int result, int a2, unsigned int *a3, unsigned int *a4)
{
  return gralloc_specific_change_ionflags_size(result, a2, a3, a4);
}

//----- (00001548) --------------------------------------------------------
int __fastcall gralloc_specific_clear_buffer(int a1, int a2)
{
  return gralloc_specific_clear_buffer(a1, a2);
}

//----- (00001590) --------------------------------------------------------
int __fastcall gralloc_specific_get_default_ionheap(private_module_t *a1)
{
  return gralloc_specific_get_default_ionheap(a1);
}

//----- (000015B4) --------------------------------------------------------
int __fastcall gralloc_backend_cache_op(int a1, int a2, int a3)
{
  return gralloc_backend_cache_op(a1, a2, a3);
}

//----- (000015D8) --------------------------------------------------------
signed int __fastcall gralloc_specific_fb_post(int a1, int a2)
{
  return gralloc_specific_fb_post(a1, a2);
}

//----- (00001620) --------------------------------------------------------
int __fastcall init_frame_buffer_locked(private_module_t *a1, int a2, int a3)
{
  return init_frame_buffer_locked(a1, a2, a3);
}

//----- (000017BC) --------------------------------------------------------
signed int __fastcall sub_17BC(int a1)
{
  signed int result; // r0@6

  if ( a1 && *(_DWORD *)a1 == 12 && *(_DWORD *)(a1 + 8) == 48 && *(_DWORD *)(a1 + 4) == 1 )
  {
    if ( *(_DWORD *)(a1 + 16) == 51647890 )
      result = 0;
    else
      result = -22;
  }
  else
  {
    result = -22;
  }
  return result;
}

//----- (000017EC) --------------------------------------------------------
signed int __fastcall sub_17EC(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8)
{
  int v8; // r7@1
  int v9; // r4@1
  char v10; // r6@1
  int v11; // r2@1
  const char *v12; // r1@2
  const char *v13; // r2@2
  const char *v14; // r3@2
  signed int result; // r0@5
  int v16; // r4@10
  signed int v17; // [sp+0h] [bp-20h]@2
  int v18; // [sp+4h] [bp-1Ch]@2
  int v19; // [sp+8h] [bp-18h]@1

  v19 = a3;
  v8 = a1;
  v9 = a2;
  v10 = a3;
  if ( sub_17BC(a2) < 0 )
  {
    v17 = 178;
    v18 = v9;
    v12 = "[Gralloc-ERROR]";
    v13 = "%s:%d Locking invalid buffer %p, returning error";
    v14 = "int gralloc_lock_ycbcr(const gralloc_module_t*, buffer_handle_t, int, int, int, int, int, android_ycbcr*)";
LABEL_5:
    _android_log_print(6, v12, v13, v14, v17, v18, v19);
    return -22;
  }
  if ( !a8 )
  {
    v17 = 183;
    v18 = 0;
    v12 = "[Gralloc-ERROR]";
    v14 = "int gralloc_lock_ycbcr(const gralloc_module_t*, buffer_handle_t, int, int, int, int, int, android_ycbcr*)";
    v13 = "%s:%d invalid ycbcr %p, returning error";
    goto LABEL_5;
  }
  if ( *(_DWORD *)(v9 + 36) & 6 )
    *(_DWORD *)(v9 + 60) = v10 & 0xF0;
  if ( (v10 & 0xF) == 3 )
    gralloc_backend_invalidate(v8, v9, v11);
  *(_DWORD *)a8 = *(_DWORD *)(v9 + 48);
  *(_DWORD *)(a8 + 8) = *(_DWORD *)(v9 + 112) + *(_DWORD *)(v9 + 48);
  *(_DWORD *)(a8 + 4) = *(_DWORD *)(v9 + 108) + *(_DWORD *)(v9 + 48);
  *(_DWORD *)(a8 + 12) = *(_DWORD *)(v9 + 156);
  v16 = *(_DWORD *)(v9 + 100);
  result = 0;
  *(_DWORD *)(a8 + 20) = 1;
  *(_DWORD *)(a8 + 16) = v16;
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00001894) --------------------------------------------------------
int __fastcall sub_1894(int a1, int a2, int a3)
{
  int v3; // r5@1
  int v4; // r4@1
  int v5; // r2@1
  int result; // r0@2
  int v7; // [sp+8h] [bp-10h]@1

  v7 = a3;
  v3 = a1;
  v4 = a2;
  if ( sub_17BC(a2) >= 0 )
  {
    result = *(_DWORD *)(v4 + 36) & 6;
    if ( result )
    {
      result = *(_DWORD *)(v4 + 60);
      if ( result )
      {
        gralloc_backend_sync(v3, v4, v5);
        result = 0;
      }
    }
  }
  else
  {
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d Unlocking invalid buffer %p, returning error",
      "int gralloc_unlock(const gralloc_module_t*, buffer_handle_t)",
      220,
      v4,
      v7);
    result = -22;
  }
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (000018E8) --------------------------------------------------------
int __fastcall sub_18E8(int a1, int a2, _DWORD *a3)
{
  int result; // r0@2

  if ( a3 )
  {
    *a3 = -1;
    result = sub_1894(a1, a2, (int)a3);
  }
  else
  {
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d NULL Pointer, fenceFd = %p",
      "int gralloc_unlockAsync(const gralloc_module_t*, buffer_handle_t, int*)",
      250,
      0,
      0);
    result = -22;
  }
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (0000192C) --------------------------------------------------------
signed int __fastcall sub_192C(int a1, int a2, int a3, int a4, int a5, int a6, int a7, _DWORD *a8)
{
  int v8; // r7@1
  signed __int64 v9; // r4@1
  int v10; // r2@1
  const char *v11; // r1@2
  const char *v12; // r2@2
  const char *v13; // r3@2
  signed int result; // r0@9
  signed __int64 v15; // [sp+0h] [bp-20h]@2
  int v16; // [sp+8h] [bp-18h]@1

  v16 = a3;
  v8 = a1;
  HIDWORD(v9) = a2;
  LOBYTE(v9) = a3;
  if ( sub_17BC(a2) < 0 )
  {
    LODWORD(v9) = 142;
    v15 = v9;
    v11 = "[Gralloc-ERROR]";
    v12 = "%s:%d Locking invalid buffer %p, returning error";
    v13 = "int gralloc_lock(const gralloc_module_t*, buffer_handle_t, int, int, int, int, int, void**)";
LABEL_12:
    _android_log_print(6, v11, v12, v13, v15, v16);
    return -22;
  }
  if ( *(_DWORD *)(HIDWORD(v9) + 20) == 35 )
  {
    v15 = 150323855509LL;
    v11 = "[Gralloc-ERROR]";
    v12 = "%s:%d Locking invalid format %d, returning error";
    v13 = "int gralloc_lock(const gralloc_module_t*, buffer_handle_t, int, int, int, int, int, void**)";
    goto LABEL_12;
  }
  if ( *(_DWORD *)(HIDWORD(v9) + 36) & 6 )
    *(_DWORD *)(HIDWORD(v9) + 60) = v9 & 0xF0;
  if ( (v9 & 0xF) == 3 )
    gralloc_backend_invalidate(v8, SHIDWORD(v9), v10);
  result = (unsigned __int8)v9;
  if ( (_BYTE)v9 )
  {
    if ( !a8 )
    {
      v15 = 166LL;
      v11 = "[Gralloc-ERROR]";
      v12 = "%s:%d NULL Pointer vaddr = %p";
      v13 = "int gralloc_lock(const gralloc_module_t*, buffer_handle_t, int, int, int, int, int, void**)";
      goto LABEL_12;
    }
    result = 0;
    *a8 = *(_DWORD *)(HIDWORD(v9) + 48);
  }
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (000019E4) --------------------------------------------------------
signed int __fastcall sub_19E4(int a1, int a2, int a3, int a4, int a5, int a6, int a7, _DWORD *a8, int a9)
{
  int v9; // r5@1
  int v10; // r8@1
  int v11; // r7@1
  int v12; // r6@1
  int v13; // r3@1

  v9 = a4;
  v10 = a1;
  v11 = a2;
  v12 = a3;
  v13 = a5;
  if ( a9 > 0 )
  {
    sync_wait(a9, 5000);
    close(a9);
    v13 = a5;
  }
  return sub_192C(v10, v11, v12, v9, v13, a6, a7, a8);
}
// 13EC: using guessed type int __fastcall sync_wait(_DWORD, _DWORD);

//----- (00001A38) --------------------------------------------------------
int __fastcall sub_1A38(int a1, int a2, int a3, int a4)
{
  int v4; // r4@1
  int v5; // r5@2
  int v6; // r6@7
  int v7; // r1@8
  int v8; // r6@12
  __pid_t v9; // r0@12
  int v11; // [sp+8h] [bp-18h]@1
  int v12; // [sp+Ch] [bp-14h]@1

  v11 = a3;
  v12 = a4;
  v4 = a2;
  if ( sub_17BC(a2) >= 0 )
  {
    if ( *(_DWORD *)(v4 + 56) & 0x3FFFFFFF )
      _android_log_print(
        6,
        "[Gralloc-ERROR]",
        "%s:%d [unregister] handle %p still locked (state=%08x)",
        "int gralloc_unregister_buffer(const gralloc_module_t*, buffer_handle_t)",
        104,
        v4,
        *(_DWORD *)(v4 + 56),
        v12);
    v5 = *(_DWORD *)(v4 + 36) & 1;
    if ( v5 )
    {
      v5 = 0;
      _android_log_print(
        6,
        "[Gralloc-ERROR]",
        "%s:%d Can't unregister buffer %p as it is a framebuffer",
        "int gralloc_unregister_buffer(const gralloc_module_t*, buffer_handle_t)",
        108,
        v4,
        v11,
        v12);
    }
    else
    {
      v6 = *(_DWORD *)(v4 + 64);
      if ( v6 == getpid() )
      {
        pthread_mutex_lock((pthread_mutex_t *)&unk_8014);
        v7 = *(_DWORD *)(v4 + 36);
        if ( v7 & 6 )
          gralloc_backend_unregister(v4);
        else
          _android_log_print(
            6,
            "[Gralloc-ERROR]",
            "%s:%d Unregistering unknown buffer is not supported. Flags = %d",
            "int gralloc_unregister_buffer(const gralloc_module_t*, buffer_handle_t)",
            121,
            v7,
            v11,
            v12);
        *(_DWORD *)(v4 + 48) = 0;
        *(_DWORD *)(v4 + 56) = 0;
        *(_DWORD *)(v4 + 60) = 0;
        pthread_mutex_unlock((pthread_mutex_t *)&unk_8014);
      }
      else
      {
        v8 = *(_DWORD *)(v4 + 64);
        v9 = getpid();
        _android_log_print(
          6,
          "[Gralloc-ERROR]",
          "%s:%d Trying to unregister buffer %p from process %d that was not created in current process: %d",
          "int gralloc_unregister_buffer(const gralloc_module_t*, buffer_handle_t)",
          132,
          v4,
          v8,
          v9);
      }
    }
  }
  else
  {
    v5 = -22;
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d unregistering invalid buffer %p, returning error",
      "int gralloc_unregister_buffer(const gralloc_module_t*, buffer_handle_t)",
      98,
      v4,
      v11,
      v12);
  }
  return v5;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00001B60) --------------------------------------------------------
signed int __fastcall sub_1B60(int a1, int a2, int a3, int a4)
{
  int v4; // r5@1
  int v5; // r4@1
  int v7; // r6@3
  __pid_t v8; // r0@5
  int v9; // r1@5
  const char *v10; // r1@6
  const char *v11; // r2@6
  const char *v12; // r3@6
  int v13; // r4@8
  signed int v14; // [sp+0h] [bp-20h]@6
  int v15; // [sp+4h] [bp-1Ch]@6
  int v16; // [sp+8h] [bp-18h]@1
  int v17; // [sp+Ch] [bp-14h]@1

  v16 = a3;
  v17 = a4;
  v4 = a1;
  v5 = a2;
  if ( sub_17BC(a2) < 0 )
  {
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d Registering invalid buffer %p, returning error",
      "int gralloc_register_buffer(const gralloc_module_t*, buffer_handle_t)",
      55,
      v5,
      v16,
      v17);
    return -22;
  }
  v7 = *(_DWORD *)(v5 + 64);
  if ( v7 == getpid() )
    _android_log_print(
      5,
      "[Gralloc-Warning]",
      "%s:%d Registering handle %p coming from the same process: %d.",
      "int gralloc_register_buffer(const gralloc_module_t*, buffer_handle_t)",
      66,
      v5,
      *(_DWORD *)(v5 + 64),
      v17);
  pthread_mutex_lock((pthread_mutex_t *)&unk_8014);
  v8 = getpid();
  v9 = *(_DWORD *)(v5 + 36);
  *(_DWORD *)(v5 + 64) = v8;
  if ( v9 & 1 )
  {
    v14 = 77;
    v15 = v5;
    v10 = "[Gralloc-ERROR]";
    v11 = "%s:%d Can't register buffer %p as it is a framebuffer";
    v12 = "int gralloc_register_buffer(const gralloc_module_t*, buffer_handle_t)";
LABEL_10:
    v13 = -22;
    _android_log_print(6, v10, v11, v12, v14, v15, v16, v17);
    goto LABEL_11;
  }
  if ( !(v9 & 6) )
  {
    v14 = 86;
    v15 = v9;
    v12 = "int gralloc_register_buffer(const gralloc_module_t*, buffer_handle_t)";
    v10 = "[Gralloc-ERROR]";
    v11 = "%s:%d registering non-UMP buffer not supported. flags = %d";
    goto LABEL_10;
  }
  v13 = gralloc_backend_register(v4, v5);
LABEL_11:
  pthread_mutex_unlock((pthread_mutex_t *)&unk_8014);
  return v13;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00001C54) --------------------------------------------------------
int __fastcall private_module_t::private_module_t(int a1)
{
  int v1; // r4@1
  int result; // r0@1

  v1 = a1;
  *(_DWORD *)a1 = 1213680980;
  *(_WORD *)(a1 + 6) = 0;
  *(_WORD *)(a1 + 4) = 3;
  *(_DWORD *)(a1 + 8) = "gralloc";
  *(_DWORD *)(a1 + 12) = "Graphics Memory Allocator Module";
  *(_DWORD *)(a1 + 24) = 0;
  *(_DWORD *)(a1 + 16) = "ARM Ltd.";
  *(_DWORD *)(a1 + 20) = &off_8004;
  memset((void *)(a1 + 28), 0, 0x64u);
  *(_DWORD *)(v1 + 144) = 0;
  *(_DWORD *)(v1 + 160) = 0;
  *(_DWORD *)(v1 + 128) = sub_1B60;
  *(_DWORD *)(v1 + 132) = sub_1A38;
  *(_DWORD *)(v1 + 136) = sub_192C;
  *(_DWORD *)(v1 + 140) = sub_1894;
  *(_DWORD *)(v1 + 148) = sub_17EC;
  *(_DWORD *)(v1 + 152) = sub_19E4;
  *(_DWORD *)(v1 + 156) = sub_18E8;
  memset((void *)(v1 + 164), 0, 0xCu);
  *(_DWORD *)(v1 + 176) = 0;
  *(_DWORD *)(v1 + 180) = 0;
  *(_DWORD *)(v1 + 184) = 0;
  *(_DWORD *)(v1 + 188) = 0;
  pthread_mutex_init((pthread_mutex_t *)(v1 + 192), 0);
  *(_DWORD *)(v1 + 196) = 0;
  *(_DWORD *)(v1 + 204) = 0;
  *(_DWORD *)(v1 + 200) = -1;
  memset((void *)(v1 + 208), 0, 0xA0u);
  memset((void *)(v1 + 368), 0, 0x44u);
  *(_DWORD *)(v1 + 436) = 0;
  result = v1;
  *(_DWORD *)(v1 + 440) = 0;
  *(_DWORD *)(v1 + 444) = 0;
  return result;
}
// 8004: using guessed type void *off_8004;

//----- (00001D5C) --------------------------------------------------------
signed int __fastcall sub_1D5C(int a1, int a2, int a3)
{
  void *v3; // r4@1
  const char *v4; // r1@7
  const char *v5; // r2@7
  const char *v6; // r3@7
  int v8; // r5@10
  signed __int64 v9; // [sp+0h] [bp-18h]@7
  int v10; // [sp+8h] [bp-10h]@1

  v10 = a3;
  v3 = (void *)a2;
  if ( !a2
    || *(_DWORD *)a2 != 12
    || *(_DWORD *)(a2 + 8) != 48
    || *(_DWORD *)(a2 + 4) != 1
    || *(_DWORD *)(a2 + 16) != 51647890 )
  {
    return -22;
  }
  if ( !a1 )
  {
    v9 = 399LL;
    v4 = "[Gralloc-ERROR]";
    v5 = "%s:%d NULL Pointer, dev = %p";
    v6 = "int alloc_device_free(alloc_device_t*, buffer_handle_t)";
LABEL_8:
    _android_log_print(6, v4, v5, v6, v9, v10);
    return -22;
  }
  v8 = *(_DWORD *)(a1 + 8);
  if ( !v8 )
  {
    v9 = 407LL;
    v4 = "[Gralloc-ERROR]";
    v5 = "%s:%d NULL Pointer, m = %p";
    v6 = "int alloc_device_free(alloc_device_t*, buffer_handle_t)";
    goto LABEL_8;
  }
  if ( *(_DWORD *)(a2 + 36) & 1 )
  {
    *(_DWORD *)(v8 + 188) &= ~(1 << (*(_DWORD *)(a2 + 48) - *(_DWORD *)(*(_DWORD *)(v8 + 176) + 48))
                                  / (unsigned int)(*(_DWORD *)(v8 + 412) * *(_DWORD *)(v8 + 212)));
    close(*(_DWORD *)(a2 + 72));
  }
  alloc_backend_alloc_free((int)v3, v8);
  operator delete(v3);
  return 0;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00001E1C) --------------------------------------------------------
signed int __fastcall sub_1E1C(unsigned int a1, unsigned int a2, int a3, int a4, int a5, int *a6, unsigned int *a7)
{
  int v7; // r6@1
  unsigned int v8; // r10@1
  int v9; // r5@1
  int v10; // r0@4
  int v11; // r7@4
  bool v12; // zf@12
  unsigned int v13; // r11@23
  unsigned int v14; // r8@23
  int v15; // r4@23
  unsigned int v16; // r6@23
  signed int v17; // r0@24
  int v18; // r1@26
  unsigned int v19; // r1@29
  const char *v20; // r1@30
  const char *v21; // r2@30
  const char *v22; // r3@30
  unsigned int v23; // r4@31
  unsigned int v24; // r3@31
  signed int v25; // ST14_4@45
  unsigned int v26; // r0@45
  signed int result; // r0@45
  __int64 v28; // r2@46
  int v29; // r4@46
  int v30; // r7@46
  unsigned int v31; // r5@46
  unsigned int v32; // r6@46
  unsigned int *v33; // [sp+0h] [bp-58h]@26
  unsigned int *v34; // [sp+0h] [bp-58h]@30
  unsigned int *v35; // [sp+4h] [bp-54h]@26
  unsigned int *v36; // [sp+4h] [bp-54h]@30
  int *v37; // [sp+8h] [bp-50h]@26
  unsigned int v38; // [sp+10h] [bp-48h]@1
  unsigned int v39; // [sp+18h] [bp-40h]@23
  unsigned int v40; // [sp+1Ch] [bp-3Ch]@23
  int v41; // [sp+20h] [bp-38h]@23
  unsigned int v42; // [sp+24h] [bp-34h]@23
  unsigned int v43; // [sp+28h] [bp-30h]@23
  unsigned int v44; // [sp+2Ch] [bp-2Ch]@23

  v7 = a4;
  v8 = a2;
  v38 = a1;
  v9 = a3;
  if ( !a6 || !a7 )
  {
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d NULL pointer, pHandle = %p, pStride = %p",
      "int alloc_device_alloc(alloc_device_t*, int, int, int, int, const native_handle_t**, int*)",
      182,
      a6,
      a7);
    return -22;
  }
  _android_log_print(4, "[Gralloc]", "alloc w[%d] h[%d] format[%d] usage[%d]", a2, a3, a4, a5);
  v10 = gralloc_specific_convert_format(v7, a5);
  v11 = v10;
  if ( v10 == 20 )
    goto LABEL_27;
  if ( v10 > 20 )
  {
    if ( v10 != 35 )
    {
      if ( v10 <= 35 )
      {
        if ( v10 != 32 )
        {
          if ( v10 != 33 )
            return -22;
          if ( v9 == 1 )
          {
            v15 = 1;
            v17 = 1;
            v40 = v8;
            v41 = v8;
            v39 = v8;
            goto LABEL_44;
          }
          v34 = (unsigned int *)292;
          v36 = (unsigned int *)v9;
          v20 = "[Gralloc-ERROR]";
          v21 = "%s:%d buffer format HAL_PIXEL_FORMAT_BLOB must have height == 1, now is %d";
          v22 = "int alloc_device_alloc(alloc_device_t*, int, int, int, int, const native_handle_t**, int*)";
          goto LABEL_42;
        }
LABEL_27:
        v33 = &v39;
        v15 = (v9 + 15) & 0xFFFFFFF0;
        v37 = &v41;
        v18 = (v8 + 15) & 0xFFFFFFF0;
        v35 = &v40;
        goto LABEL_28;
      }
      if ( v10 != 257 && v10 != 842094169 )
      {
        v12 = v10 == 256;
        goto LABEL_21;
      }
    }
    v19 = (v8 + 127) & 0xFFFFFF80;
    v41 = (v8 + 127) & 0xFFFFFF80;
    v40 = (v8 + 127) & 0xFFFFFF80;
    v39 = v9 * v19;
    if ( a5 >= 0 )
    {
      v14 = v19 >> 1;
      v23 = v9 / 2;
      gralloc_specific_calc_special_size(a5, v7, 1, v9 / 2, v19 >> 1, &v44, &v39);
      v13 = v39;
      v24 = v39 + 2 * v44;
      if ( v11 == 842094169 )
        v16 = v39;
      else
        v16 = v24 - v44;
      if ( v11 == 842094169 )
        v13 = v24 - v44;
      v39 += 2 * v44;
      if ( !(a5 & 0xF0) )
        v23 = (v23 + 15) & 0xFFFFFFF0;
      v15 = v9 + 2 * v23;
LABEL_39:
      v17 = 1;
      goto LABEL_45;
    }
    v34 = (unsigned int *)266;
    v36 = (unsigned int *)v10;
    v20 = "[Gralloc-ERROR]";
    v21 = "%s:%d planar not support K3 tile, format 0x%x";
    v22 = "int alloc_device_alloc(alloc_device_t*, int, int, int, int, const native_handle_t**, int*)";
LABEL_42:
    _android_log_print(6, v20, v21, v22, v34, v36);
    return -22;
  }
  if ( v10 == 3 )
  {
    v15 = (v9 + 15) & 0xFFFFFFF0;
    gralloc_specific_calc_size_stride(3, v8, v9, a5, &v39, &v40, &v41);
    v17 = v11;
    goto LABEL_44;
  }
  if ( v10 <= 3 )
  {
    if ( v10 < 1 )
      return -22;
    goto LABEL_24;
  }
  if ( v10 != 5 )
  {
    if ( v10 >= 5 )
    {
      v12 = v10 == 17;
LABEL_21:
      if ( !v12 )
        return -22;
      gralloc_specific_calc_size_stride(1, v8, v9, a5, &v39, &v40, &v41);
      v13 = v39;
      v14 = v41;
      gralloc_specific_calc_size_stride(1, v8, v9 / 2, a5, &v42, &v43, (int *)&v44);
      v15 = ((v9 / 2 + 15) & 0xFFFFFFF0) + ((v9 + 15) & 0xFFFFFFF0);
      v16 = v13;
      v39 += v42;
      goto LABEL_39;
    }
    v33 = &v39;
    v15 = (v9 + 15) & 0xFFFFFFF0;
    v35 = &v40;
    v18 = v8;
    v37 = &v41;
LABEL_28:
    gralloc_specific_calc_size_stride(2, v18, v9, a5, v33, v35, v37);
    v17 = 2;
    goto LABEL_44;
  }
LABEL_24:
  v15 = (v9 + 15) & 0xFFFFFFF0;
  gralloc_specific_calc_size_stride(4, v8, v9, a5, &v39, &v40, &v41);
  v17 = 4;
LABEL_44:
  v16 = 0;
  v14 = 0;
  v13 = 0;
LABEL_45:
  v25 = v17;
  v26 = gralloc_specific_align(v38, v39);
  v39 = v26;
  result = alloc_backend_alloc(v38, (v25 * v8 + 4095) & 0xFFFFF000, v15, v26, a5, a6);
  if ( result >= 0 )
  {
    v28 = v11;
    v29 = *a6;
    *(_DWORD *)(v29 + 20) = v11;
    v30 = v41;
    *(_DWORD *)(v29 + 92) = v9;
    *(_DWORD *)(v29 + 152) = v9;
    v31 = v40;
    *(_QWORD *)(v29 + 24) = v28;
    *(_DWORD *)(v29 + 112) = v16;
    *(_DWORD *)(v29 + 32) = v30;
    *(_DWORD *)(v29 + 88) = v8;
    *(_DWORD *)(v29 + 100) = v14;
    *(_DWORD *)(v29 + 108) = v13;
    *(_DWORD *)(v29 + 104) = v14;
    *(_DWORD *)(v29 + 136) = a5;
    *(_DWORD *)(v29 + 148) = v8;
    *(_DWORD *)(v29 + 156) = v31;
    gralloc_specific_set_yuvinfo(a5, v29);
    v32 = v40;
    *a7 = v40;
    _android_log_print(4, "[Gralloc]", "alloc succ handle[%p] stride[%zu]", v29, v32);
    result = 0;
  }
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (0000212C) --------------------------------------------------------
signed int __fastcall alloc_device_open(int a1, int a2, int *a3, int a4)
{
  int *v4; // r5@1
  int v5; // r6@1
  int v6; // r4@4
  signed int result; // r0@4

  v4 = a3;
  v5 = a1;
  if ( !a1 || !a3 )
  {
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d NULL pointer, module = %p, device = %p",
      "int alloc_device_open(const hw_module_t*, const char*, hw_device_t**)",
      594,
      a1,
      a3,
      a4);
    return -1;
  }
  v6 = operator new(0x68u);
  memset((void *)v6, 0, 0x68u);
  *(_DWORD *)(v6 + 8) = v5;
  *(_DWORD *)(v6 + 60) = alloc_backend_close;
  *(_DWORD *)v6 = 1213678676;
  *(_DWORD *)(v6 + 64) = sub_1E1C;
  *(_DWORD *)(v6 + 68) = sub_1D5C;
  result = alloc_backend_open(v6, (int)sub_1E1C, (int)sub_1D5C);
  if ( result )
  {
    operator delete((void *)v6);
    return -1;
  }
  *v4 = v6;
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (000021B4) --------------------------------------------------------
signed int __fastcall alloc_backend_alloc(unsigned int a1, int a2, int a3, size_t a4, int a5, int *a6)
{
  int v6; // r10@1
  unsigned int v7; // r5@1
  int v8; // r6@4
  signed int v9; // r7@4
  const char *v10; // r2@8
  const char *v11; // r3@8
  const char *v12; // r1@8
  const char *v13; // r7@11
  void *v14; // r10@25
  signed int result; // r0@32
  int v20; // r4@33
  size_t v21; // r2@33
  __pid_t v22; // r0@33
  signed int v23; // r1@33
  int v24; // r5@33
  int v25; // r3@33
  int v26; // r0@33
  int v27; // r2@33
  int v28; // r0@33
  int v29; // r5@33
  int v30; // [sp+0h] [bp-68h]@8
  __off_t offset; // [sp+4h] [bp-64h]@8
  int v32; // [sp+10h] [bp-58h]@10
  int fd; // [sp+14h] [bp-54h]@13
  int v34; // [sp+18h] [bp-50h]@1
  int v35; // [sp+1Ch] [bp-4Ch]@1
  size_t len; // [sp+20h] [bp-48h]@1
  int s; // [sp+24h] [bp-44h]@4
  int v38; // [sp+28h] [bp-40h]@33
  int v39; // [sp+2Ch] [bp-3Ch]@33
  int v40; // [sp+30h] [bp-38h]@33

  v6 = a2;
  v7 = a1;
  v34 = 0;
  v35 = 0;
  len = a4;
  if ( !a1 || !a6 )
  {
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d NULL pointer, dev = %p, pHandle = %p",
      "int alloc_backend_alloc(alloc_device_t*, int, int, size_t, int, const native_handle_t**)",
      61,
      a1,
      a6);
    return -1;
  }
  v8 = *(_DWORD *)(a1 + 8);
  memset(&s, 0, 0x1Cu);
  v9 = gralloc_specific_select_heap(a5, byte_81D8);
  if ( (a5 & 0xF) == 3 )
    v34 = a5 & 0xF;
  gralloc_specific_change_ionflags_size(v7, a5, (unsigned int *)&v34, &len);
  if ( ion_alloc(*(_DWORD *)(v8 + 200), len, 0, v9) )
  {
    if ( v9 == 32 )
      return -1;
    v30 = 96;
    v10 = "%s:%d Failed to ion_alloc from ion_client:%d";
    v11 = "int alloc_backend_alloc(alloc_device_t*, int, int, size_t, int, const native_handle_t**)";
    offset = *(_DWORD *)(v8 + 200);
    v12 = "[Gralloc-ERROR]";
LABEL_24:
    _android_log_print(6, v12, v10, v11, v30, offset);
    return -1;
  }
  if ( v9 == 1 && ion_map_iommu(*(_DWORD *)(v8 + 200), v32, &s) )
  {
    v13 = "int alloc_backend_alloc(alloc_device_t*, int, int, size_t, int, const native_handle_t**)";
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d ion_map_iommu( %d ) failed, usage ( %x ), byte_w ( %d )",
      "int alloc_backend_alloc(alloc_device_t*, int, int, size_t, int, const native_handle_t**)",
      108,
      *(_DWORD *)(v8 + 200),
      a5,
      v6);
    if ( !ion_free(*(_DWORD *)(v8 + 200), v32) )
      return -1;
    v12 = "[Gralloc-ERROR]";
    v30 = 109;
    v10 = "%s:%d ion_free( %d ) failed";
    offset = *(_DWORD *)(v8 + 200);
    goto LABEL_23;
  }
  if ( ion_share(*(_DWORD *)(v8 + 200), v32, &fd) )
  {
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d ion_share( %d ) failed",
      "int alloc_backend_alloc(alloc_device_t*, int, int, size_t, int, const native_handle_t**)",
      118,
      *(_DWORD *)(v8 + 200));
    if ( v9 == 1 )
    {
      if ( ion_unmap_iommu(*(_DWORD *)(v8 + 200), v32, &s) )
        _android_log_print(
          6,
          "[Gralloc-ERROR]",
          "%s:%d Failed to unmap iommu handle 0x%x",
          "int alloc_backend_alloc(alloc_device_t*, int, int, size_t, int, const native_handle_t**)",
          122,
          v32);
    }
    if ( !ion_free(*(_DWORD *)(v8 + 200), v32) )
      return -1;
    v30 = 125;
    v10 = "%s:%d ion_free( %d ) failed";
    v11 = "int alloc_backend_alloc(alloc_device_t*, int, int, size_t, int, const native_handle_t**)";
    v12 = "[Gralloc-ERROR]";
    offset = *(_DWORD *)(v8 + 200);
    goto LABEL_24;
  }
  if ( v9 != 1 && ion_get_phys(*(_DWORD *)(v8 + 200), fd, &v35) )
  {
    v13 = "int alloc_backend_alloc(alloc_device_t*, int, int, size_t, int, const native_handle_t**)";
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d ion_get_phys( %d ) failed",
      "int alloc_backend_alloc(alloc_device_t*, int, int, size_t, int, const native_handle_t**)",
      134,
      *(_DWORD *)(v8 + 200));
    close(fd);
    if ( !ion_free(*(_DWORD *)(v8 + 200), v32) )
      return -1;
    v12 = "[Gralloc-ERROR]";
    v30 = 136;
    v10 = "%s:%d ion_free( %d ) failed";
    offset = *(_DWORD *)(v8 + 200);
LABEL_23:
    v11 = v13;
    goto LABEL_24;
  }
  v14 = mmap(0, len, 3, 1, fd, 0);
  if ( v14 == (void *)-1 )
  {
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d ion_map( %d ) failed",
      "int alloc_backend_alloc(alloc_device_t*, int, int, size_t, int, const native_handle_t**)",
      145,
      *(_DWORD *)(v8 + 200));
    if ( v9 == 1 && ion_unmap_iommu(*(_DWORD *)(v8 + 200), v32, &s) )
      _android_log_print(
        6,
        "[Gralloc-ERROR]",
        "%s:%d Failed to unmap iommu handle 0x%x",
        "int alloc_backend_alloc(alloc_device_t*, int, int, size_t, int, const native_handle_t**)",
        149,
        v32);
    if ( ion_free(*(_DWORD *)(v8 + 200), v32) )
      _android_log_print(
        6,
        "[Gralloc-ERROR]",
        "%s:%d ion_free( %d ) failed",
        "int alloc_backend_alloc(alloc_device_t*, int, int, size_t, int, const native_handle_t**)",
        152,
        *(_DWORD *)(v8 + 200));
    close(fd);
    return -1;
  }
  __asm { VMOV.I32        D8, #0 }
  v20 = operator new(0xD0u);
  v21 = len;
  *(_DWORD *)(v20 + 12) = -1;
  *(_DWORD *)(v20 + 36) = 4;
  *(_DWORD *)(v20 + 40) = v21;
  *(_DWORD *)(v20 + 56) = 0x40000000;
  *(_DWORD *)(v20 + 60) = 0;
  *(_DWORD *)(v20 + 16) = 51647890;
  __asm { VSTR            D8, [R4,#0x18] }
  *(_DWORD *)(v20 + 48) = v14;
  v22 = getpid();
  *(_DWORD *)(v20 + 68) = 0;
  v23 = 1;
  *(_DWORD *)(v20 + 72) = 0;
  *(_DWORD *)(v20 + 88) = 0;
  *(_DWORD *)(v20 + 92) = 0;
  *(_DWORD *)(v20 + 100) = 0;
  *(_DWORD *)(v20 + 104) = 0;
  *(_DWORD *)(v20 + 108) = 0;
  *(_DWORD *)(v20 + 112) = 0;
  *(_DWORD *)(v20 + 132) = 0;
  *(_DWORD *)(v20 + 140) = 0;
  *(_DWORD *)(v20 + 164) = 0;
  *(_DWORD *)(v20 + 168) = 0;
  *(_DWORD *)(v20 + 172) = 0;
  *(_DWORD *)(v20 + 176) = 0;
  *(_DWORD *)(v20 + 180) = 0;
  *(_DWORD *)(v20 + 184) = 0;
  *(_DWORD *)(v20 + 192) = 0;
  *(_DWORD *)(v20 + 196) = 0;
  *(_DWORD *)(v20 + 200) = 0;
  *(_DWORD *)(v20 + 64) = v22;
  *(_DWORD *)v20 = 12;
  v24 = v35;
  *(_DWORD *)(v20 + 188) = 255;
  v25 = fd;
  *(_DWORD *)(v20 + 8) = 48;
  v26 = v32;
  *(_DWORD *)(v20 + 4) = 1;
  v27 = s;
  *(_DWORD *)(v20 + 96) = v24;
  *(_DWORD *)(v20 + 12) = v25;
  *(_DWORD *)(v20 + 160) = v26;
  *(_DWORD *)(v20 + 144) = v24;
  __asm { VSTR            D8, [R4,#0x50] }
  *(_DWORD *)(v20 + 116) = v27;
  v28 = v39;
  v29 = v40;
  *(_DWORD *)(v20 + 120) = v38;
  *(_DWORD *)(v20 + 124) = v28;
  *(_DWORD *)(v20 + 128) = v29;
  if ( _ZF )
  {
    v23 = 2;
LABEL_37:
    *(_DWORD *)(v20 + 132) = v23;
    goto LABEL_38;
  }
  if ( a5 < 0 )
    goto LABEL_37;
LABEL_38:
  if ( !(v34 & 4) )
    gralloc_specific_clear_buffer(*(_DWORD *)(v8 + 200), v20);
  result = 0;
  *a6 = v20;
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 14F4: using guessed type int __fastcall ion_alloc(_DWORD, _DWORD, _DWORD, _DWORD);
// 1500: using guessed type int __fastcall ion_map_iommu(_DWORD, _DWORD, _DWORD);
// 150C: using guessed type int __fastcall ion_free(_DWORD, _DWORD);
// 1518: using guessed type int __fastcall ion_share(_DWORD, _DWORD, _DWORD);
// 1524: using guessed type int __fastcall ion_unmap_iommu(_DWORD, _DWORD, _DWORD);
// 1530: using guessed type int __fastcall ion_get_phys(_DWORD, _DWORD, _DWORD);
// 81D8: using guessed type char byte_81D8;

//----- (00002598) --------------------------------------------------------
signed int __fastcall alloc_backend_alloc_framebuffer(int a1, int a2)
{
  int v2; // r5@1
  int v3; // r4@4
  int v5; // [sp+10h] [bp-18h]@4

  v2 = a2;
  if ( !a1 || !a2 )
  {
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d NULL pointer, m = %p, hnd = %p",
      "int alloc_backend_alloc_framebuffer(private_module_t*, private_handle_t*)",
      212,
      a1,
      a2);
    return -1;
  }
  v3 = ioctl(*(_DWORD *)(*(_DWORD *)(a1 + 176) + 72), 0x80084621, &v5);
  if ( v3 )
    return -1;
  _android_log_print(4, "[Gralloc]", "framebuffer accessed with dma buf (fd 0x%x)\n", v5);
  *(_DWORD *)(v2 + 12) = v5;
  return v3;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00002608) --------------------------------------------------------
void *__fastcall alloc_backend_alloc_free(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r5@1
  void *result; // r0@1
  int v5; // r3@4
  void *v6; // r0@8
  char s; // [sp+14h] [bp-2Ch]@1

  v2 = a1;
  v3 = a2;
  result = memset(&s, 0, 0x1Cu);
  if ( v2 && v3 )
  {
    v5 = *(_DWORD *)(v2 + 36);
    if ( !(v5 & 1) )
    {
      if ( v5 & 2 )
      {
        result = (void *)_android_log_print(
                           6,
                           "[Gralloc-ERROR]",
                           "%s:%d Can't free ump memory for handle:%p. Not supported.",
                           "void alloc_backend_alloc_free(const private_handle_t*, private_module_t*)",
                           248,
                           v2);
      }
      else if ( v5 & 4 )
      {
        v6 = *(void **)(v2 + 48);
        if ( v6 && munmap(v6, *(_DWORD *)(v2 + 40)) )
          _android_log_print(
            6,
            "[Gralloc-ERROR]",
            "%s:%d Failed to munmap handle %p",
            "void alloc_backend_alloc_free(const private_handle_t*, private_module_t*)",
            255,
            v2);
        close(*(_DWORD *)(v2 + 12));
        if ( !*(_DWORD *)(v2 + 96) && ion_unmap_iommu(*(_DWORD *)(v3 + 200), *(_DWORD *)(v2 + 160), &s) )
          _android_log_print(
            6,
            "[Gralloc-ERROR]",
            "%s:%d Failed to unmap iommu handle %p",
            "void alloc_backend_alloc_free(const private_handle_t*, private_module_t*)",
            262,
            v2);
        if ( ion_free(*(_DWORD *)(v3 + 200), *(_DWORD *)(v2 + 160)) )
          _android_log_print(
            6,
            "[Gralloc-ERROR]",
            "%s:%d Failed to ion_free( ion_client: %d ion_hnd: %d )",
            "void alloc_backend_alloc_free(const private_handle_t*, private_module_t*)",
            266,
            *(_DWORD *)(v3 + 200),
            *(_DWORD *)(v2 + 160));
        result = j_j_memset((void *)v2, 0, 0xD0u);
      }
    }
  }
  else
  {
    result = (void *)_android_log_print(
                       6,
                       "[Gralloc-ERROR]",
                       "%s:%d NULL pointer, hnd = %p, m = %p",
                       "void alloc_backend_alloc_free(const private_handle_t*, private_module_t*)",
                       238,
                       v2,
                       v3);
  }
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 150C: using guessed type int __fastcall ion_free(_DWORD, _DWORD);
// 1524: using guessed type int __fastcall ion_unmap_iommu(_DWORD, _DWORD, _DWORD);

//----- (0000273C) --------------------------------------------------------
signed int __fastcall alloc_backend_open(int a1, int a2, int a3)
{
  const char *v3; // r1@2
  const char *v4; // r2@2
  const char *v5; // r3@2
  int v6; // r4@3
  int v8; // r0@7
  int v9; // r0@8
  int *v10; // r0@9
  char *v11; // r0@9
  signed int v12; // [sp+0h] [bp-18h]@2
  int v13; // [sp+8h] [bp-10h]@1

  v13 = a3;
  if ( !a1 )
  {
    v12 = 276;
    v3 = "[Gralloc-ERROR]";
    v4 = "%s:%d NULL pointer, dev = %p";
    v5 = "int alloc_backend_open(alloc_device_t*)";
LABEL_5:
    _android_log_print(6, v3, v4, v5, v12, 0, v13);
    return -1;
  }
  v6 = *(_DWORD *)(a1 + 8);
  if ( !v6 )
  {
    v12 = 282;
    v3 = "[Gralloc-ERROR]";
    v4 = "%s:%d NULL pointer, m = %p";
    v5 = "int alloc_backend_open(alloc_device_t*)";
    goto LABEL_5;
  }
  v8 = pthread_mutex_lock((pthread_mutex_t *)(v6 + 192));
  if ( *(_DWORD *)(v6 + 200) < 0 )
  {
    v9 = ion_open(v8);
    *(_DWORD *)(v6 + 200) = v9;
    if ( v9 < 0 )
    {
      v10 = (int *)_errno(v9);
      v11 = strerror(*v10);
      _android_log_print(
        6,
        "[Gralloc-ERROR]",
        "%s:%d ion_open failed with %s",
        "int alloc_backend_open(alloc_device_t*)",
        292,
        v11,
        v13);
      pthread_mutex_unlock((pthread_mutex_t *)(v6 + 192));
      return -1;
    }
  }
  ++*(_DWORD *)(v6 + 204);
  pthread_mutex_unlock((pthread_mutex_t *)(v6 + 192));
  byte_81D8 = gralloc_specific_get_default_ionheap((private_module_t *)v6);
  return 0;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 156C: using guessed type int __fastcall ion_open(_DWORD);
// 1578: using guessed type int __fastcall _errno(_DWORD);
// 81D8: using guessed type char byte_81D8;

//----- (00002810) --------------------------------------------------------
int __fastcall alloc_backend_close(int a1)
{
  void *v1; // r6@1
  int v2; // r4@2
  int v3; // r3@2

  v1 = (void *)a1;
  if ( a1 )
  {
    v2 = *(_DWORD *)(a1 + 8);
    pthread_mutex_lock((pthread_mutex_t *)(v2 + 192));
    v3 = *(_DWORD *)(v2 + 204);
    *(_DWORD *)(v2 + 204) = v3 - 1;
    if ( v3 == 1 )
    {
      if ( ion_close(*(_DWORD *)(v2 + 200)) )
        _android_log_print(
          6,
          "[Gralloc-ERROR]",
          "%s:%d Failed to close ion_client: %d",
          "int alloc_backend_close(hw_device_t*)",
          318,
          *(_DWORD *)(v2 + 200));
      close(*(_DWORD *)(v2 + 200));
      *(_DWORD *)(v2 + 200) = -1;
      operator delete(v1);
    }
    pthread_mutex_unlock((pthread_mutex_t *)(v2 + 192));
  }
  return 0;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 159C: using guessed type int __fastcall ion_close(_DWORD);

//----- (00002884) --------------------------------------------------------
int __fastcall gralloc_backend_register(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r5@1
  int v4; // r0@1
  size_t v5; // r7@5
  int v6; // r0@6
  int v7; // r0@6
  int v8; // r0@7
  int v9; // r0@8
  int v10; // r0@9
  int v11; // r2@9
  pthread_mutex_t *v12; // r0@9
  int v13; // r4@9
  char *v14; // r0@11
  int *v15; // r0@12
  int *v16; // r7@12
  int v17; // r5@12
  char *v18; // r0@12

  v2 = a1;
  v3 = a2;
  v4 = *(_DWORD *)(a2 + 36) & 6;
  if ( v4 == 2 )
  {
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d Gralloc does not support UMP. Unable to register UMP memory for handle %p",
      "int gralloc_backend_register(hw_module_t*, private_handle_t*)",
      48,
      a2);
    return -22;
  }
  if ( v4 != 4 )
    return -22;
  v5 = *(_DWORD *)(a2 + 40);
  if ( !v2 )
  {
    v6 = _android_log_print(
           6,
           "[Gralloc-ERROR]",
           "%s:%d Could not get gralloc module for handle: %p",
           "int gralloc_backend_register(hw_module_t*, private_handle_t*)",
           56,
           a2);
    v7 = *(_DWORD *)_errno(v6);
    return -v7;
  }
  v8 = pthread_mutex_lock((pthread_mutex_t *)(v2 + 192));
  if ( *(_DWORD *)(v2 + 200) > 0 )
  {
LABEL_11:
    pthread_mutex_unlock((pthread_mutex_t *)(v2 + 192));
    v13 = 0;
    v14 = (char *)mmap(0, v5, 3, 1, *(_DWORD *)(v3 + 12), 0);
    if ( v14 != (char *)-1 )
    {
      *(_DWORD *)(v3 + 48) = &v14[*(_DWORD *)(v3 + 80)];
      return v13;
    }
    v15 = (int *)((int (*)(void))_errno)();
    v16 = v15;
    v17 = *(_DWORD *)(v3 + 12);
    v18 = strerror(*v15);
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d mmap( share_fd:%d ) failed with %s",
      "int gralloc_backend_register(hw_module_t*, private_handle_t*)",
      89,
      v17,
      v18);
    v7 = *v16;
    return -v7;
  }
  v9 = ion_open(v8);
  *(_DWORD *)(v2 + 200) = v9;
  if ( v9 >= 0 )
  {
    ++*(_DWORD *)(v2 + 204);
    goto LABEL_11;
  }
  v10 = _android_log_print(
          6,
          "[Gralloc-ERROR]",
          "%s:%d Could not open ion device for handle: %p",
          "int gralloc_backend_register(hw_module_t*, private_handle_t*)",
          72,
          v3);
  v11 = *(_DWORD *)_errno(v10);
  v12 = (pthread_mutex_t *)(v2 + 192);
  v13 = -v11;
  pthread_mutex_unlock(v12);
  return v13;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 156C: using guessed type int __fastcall ion_open(_DWORD);
// 1578: using guessed type int __fastcall _errno(_DWORD);

//----- (000029BC) --------------------------------------------------------
int __fastcall gralloc_backend_unregister(int result)
{
  int v1; // r1@1
  int v2; // r4@5
  int v3; // r5@5
  int *v4; // r0@6
  char *v5; // r0@6

  v1 = *(_DWORD *)(result + 36) & 6;
  if ( v1 == 2 )
  {
    result = _android_log_print(
               6,
               "[Gralloc-ERROR]",
               "%s:%d Can't unregister UMP buffer for handle %p. Not supported",
               "void gralloc_backend_unregister(private_handle_t*)",
               109,
               result);
  }
  else if ( v1 == 4 )
  {
    v2 = *(_DWORD *)(result + 40);
    v3 = *(_DWORD *)(result + 48);
    result = munmap(*(void **)(result + 48), *(_DWORD *)(result + 40));
    if ( result < 0 )
    {
      v4 = (int *)_errno(result);
      v5 = strerror(*v4);
      result = _android_log_print(
                 6,
                 "[Gralloc-ERROR]",
                 "%s:%d Could not munmap base:%p size:%d '%s'",
                 "void gralloc_backend_unregister(private_handle_t*)",
                 116,
                 v3,
                 v2,
                 v5);
    }
  }
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 1578: using guessed type int __fastcall _errno(_DWORD);

//----- (00002A3C) --------------------------------------------------------
int __fastcall gralloc_backend_cache_op(int a1, int a2, int a3)
{
  int v3; // r7@1
  int v4; // r5@1
  int v5; // r4@1
  int result; // r0@2
  int v7; // r0@3
  int v8; // r1@3
  int v9; // r3@3
  int *v10; // r0@4
  char *v11; // r0@4
  int v12; // [sp+8h] [bp-30h]@3
  int *v13; // [sp+Ch] [bp-2Ch]@3
  int s; // [sp+10h] [bp-28h]@3
  int v15; // [sp+14h] [bp-24h]@3
  int v16; // [sp+1Ch] [bp-1Ch]@3

  v3 = a2;
  v4 = a3;
  v5 = a1;
  if ( a1 )
  {
    memset(&s, 0, 0x10u);
    v7 = *(_DWORD *)(v5 + 48);
    v12 = v4;
    v8 = *(_DWORD *)(v5 + 40);
    v13 = &s;
    v9 = *(_DWORD *)(v5 + 12);
    v15 = v7;
    v16 = v8;
    s = v9;
    result = ioctl(v3, 0xC0084906, &v12);
    if ( result )
    {
      v10 = (int *)_errno(result);
      v11 = strerror(*v10);
      result = _android_log_print(4, "[Gralloc]", "gralloc_backend_cache_op FAIL cmd is %d,error %s\n", v4, v11);
    }
  }
  else
  {
    result = _android_log_print(
               6,
               "[Gralloc-ERROR]",
               "%s:%d NULL pointer, hnd = %p",
               "void gralloc_backend_cache_op(private_handle_t*, int, unsigned int)",
               125,
               0);
  }
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 1578: using guessed type int __fastcall _errno(_DWORD);

//----- (00002AC4) --------------------------------------------------------
int __fastcall gralloc_backend_sync(int a1, int a2, int a3)
{
  int v3; // r2@1
  int result; // r0@1
  const char *v5; // r3@4
  const char *v6; // r1@4
  const char *v7; // r2@4
  int v8; // r0@7
  int v9; // r1@7
  signed int v10; // [sp+0h] [bp-10h]@4
  int v11; // [sp+4h] [bp-Ch]@4
  int v12; // [sp+8h] [bp-8h]@1

  v12 = a3;
  v3 = a1;
  result = *(_DWORD *)(a2 + 36) & 6;
  if ( result == 2 )
  {
    v11 = a2;
    v10 = 159;
    v5 = "void gralloc_backend_sync(hw_module_t*, private_handle_t*)";
    v6 = "[Gralloc-ERROR]";
    v7 = "%s:%d Buffer %p is UMP type but it is not supported";
    return _android_log_print(6, v6, v7, v5, v10, v11, v12);
  }
  if ( result != 4 )
    return result;
  if ( !v3 )
  {
    v11 = a2;
    v10 = 171;
    v5 = "void gralloc_backend_sync(hw_module_t*, private_handle_t*)";
    v6 = "[Gralloc-ERROR]";
    v7 = "%s:%d Could not get gralloc module for handle %p\n";
    return _android_log_print(6, v6, v7, v5, v10, v11, v12);
  }
  if ( (signed int)((*(_DWORD *)(a2 + 40) + 4095) & 0xFFFFF000) < 0x100000 )
  {
    result = j_j_j__Z24gralloc_backend_cache_opP16private_handle_tij(a2, *(_DWORD *)(v3 + 200), 1);
  }
  else
  {
    v8 = *(_DWORD *)(v3 + 200);
    v9 = *(_DWORD *)(a2 + 12);
    result = j_j_ion_sync_fd();
  }
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00002B5C) --------------------------------------------------------
int __fastcall gralloc_backend_invalidate(int result, int a2, int a3)
{
  int v3; // r2@1
  const char *v4; // r2@4
  const char *v5; // r1@4
  const char *v6; // r3@4
  int v7; // r0@6
  int v8; // r1@6
  signed int v9; // [sp+0h] [bp-10h]@4
  int v10; // [sp+4h] [bp-Ch]@4
  int v11; // [sp+8h] [bp-8h]@1

  v11 = a3;
  v3 = *(_DWORD *)(a2 + 36) & 6;
  if ( v3 == 2 )
  {
    v10 = a2;
    v9 = 183;
    v4 = "%s:%d Buffer %p is UMP type but it is not supported";
    v5 = "[Gralloc-ERROR]";
    v6 = "void gralloc_backend_invalidate(hw_module_t*, private_handle_t*)";
    return _android_log_print(6, v5, v4, v6, v9, v10, v11);
  }
  if ( v3 == 4 )
  {
    if ( result )
    {
      v7 = *(_DWORD *)(result + 200);
      v8 = *(_DWORD *)(a2 + 12);
      return j_j_ion_invalidate_fd();
    }
    v10 = a2;
    v9 = 190;
    v4 = "%s:%d Could not get gralloc module for handle %p\n";
    v5 = "[Gralloc-ERROR]";
    v6 = "void gralloc_backend_invalidate(hw_module_t*, private_handle_t*)";
    return _android_log_print(6, v5, v4, v6, v9, v10, v11);
  }
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00002BE6) --------------------------------------------------------
int compositionComplete()
{
  glFinish();
  return 0;
}

//----- (00002BF0) --------------------------------------------------------
int __fastcall sub_2BF0(int a1, int a2)
{
  int v2; // r7@1
  int v3; // r6@1
  int v4; // r5@6
  int v5; // r4@7
  int v6; // ST04_4@10
  int v7; // r2@10
  int v8; // r3@10
  int v9; // r0@10
  const char *v10; // r2@11
  const char *v11; // r1@11
  const char *v12; // r3@11
  int v13; // r1@12
  int v14; // r3@14
  int v15; // r0@17
  signed int v17; // [sp+0h] [bp-30h]@11
  int v18; // [sp+4h] [bp-2Ch]@11
  int v19; // [sp+8h] [bp-28h]@10
  int v20; // [sp+10h] [bp-20h]@12
  int v21; // [sp+14h] [bp-1Ch]@14

  v2 = a1;
  v3 = a2;
  if ( a2
    && *(_DWORD *)a2 == 12
    && *(_DWORD *)(a2 + 8) == 48
    && *(_DWORD *)(a2 + 4) == 1
    && *(_DWORD *)(a2 + 16) == 51647890 )
  {
    v5 = *(_DWORD *)(a1 + 8);
    if ( *(_DWORD *)(v5 + 196) )
    {
      (*(void (__fastcall **)(_DWORD))(v5 + 140))(*(_DWORD *)(a1 + 8));
      *(_DWORD *)(v5 + 196) = 0;
    }
    v4 = *(_DWORD *)(v3 + 36) & 1;
    if ( !v4 )
    {
      gralloc_specific_fb_post(v2, v3);
      return v4;
    }
    v4 = 0;
    v6 = *(_DWORD *)(v5 + 208);
    v19 = *(_DWORD *)(v5 + 212);
    (*(void (__fastcall **)(int, int, unsigned int, _DWORD))(v5 + 136))(v5, v3, 2147483648, 0);
    v7 = *(_DWORD *)(v5 + 176);
    v8 = *(_DWORD *)(v3 + 48);
    v9 = *(_DWORD *)(v7 + 48);
    *(_DWORD *)(v5 + 292) = 16;
    *(_DWORD *)(v5 + 228) = (unsigned int)(v8 - v9) / *(_DWORD *)(v5 + 412);
    if ( ioctl(*(_DWORD *)(v7 + 72), 0x4606u, v5 + 208) == -1 )
    {
      v17 = 91;
      v10 = "%s:%d FBIOPAN_DISPLAY failed for fd: %d";
      v11 = "[Gralloc-ERROR]";
      v18 = *(_DWORD *)(*(_DWORD *)(v5 + 176) + 72);
      v12 = "int fb_post(framebuffer_device_t*, buffer_handle_t)";
    }
    else
    {
      v13 = *(_DWORD *)(v5 + 176);
      v20 = 1;
      if ( ioctl(*(_DWORD *)(v13 + 72), 0x400446CEu, &v20) >= 0 )
      {
        v14 = *(_DWORD *)(v5 + 176);
        v21 = 0;
        if ( ioctl(*(_DWORD *)(v14 + 72), 0x40044620u, &v21) >= 0 )
        {
          v15 = *(_DWORD *)(v5 + 176);
          v20 = 0;
          if ( ioctl(*(_DWORD *)(v15 + 72), 0x400446CEu, &v20) >= 0 )
          {
            *(_DWORD *)(v5 + 196) = v3;
            return v4;
          }
          v17 = 120;
          v11 = "[Gralloc-ERROR]";
          v12 = "int fb_post(framebuffer_device_t*, buffer_handle_t)";
          v18 = *(_DWORD *)(*(_DWORD *)(v5 + 176) + 72);
          v10 = "%s:%d S3CFB_SET_VSYNC_INT disable failed for fd: %d";
        }
        else
        {
          v17 = 110;
          v10 = "%s:%d FBIO_WAITFORVSYNC failed for fd: %d";
          v11 = "[Gralloc-ERROR]";
          v18 = *(_DWORD *)(*(_DWORD *)(v5 + 176) + 72);
          v12 = "int fb_post(framebuffer_device_t*, buffer_handle_t)";
        }
      }
      else
      {
        v17 = 101;
        v11 = "[Gralloc-ERROR]";
        v12 = "int fb_post(framebuffer_device_t*, buffer_handle_t)";
        v18 = *(_DWORD *)(*(_DWORD *)(v5 + 176) + 72);
        v10 = "%s:%d S3CFB_SET_VSYNC_INT enable failed for fd: %d";
      }
    }
    _android_log_print(6, v11, v10, v12, v17, v18, v19, 0, v20, v21);
    (*(void (__fastcall **)(int, int))(v5 + 140))(v5, v3);
    v4 = 0;
  }
  else
  {
    v4 = -22;
  }
  return v4;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00002DA0) --------------------------------------------------------
int __fastcall sub_2DA0(void *a1)
{
  if ( a1 )
    operator delete(a1);
  return 0;
}

//----- (00002DAC) --------------------------------------------------------
int __fastcall sub_2DAC(int a1)
{
  int v1; // r8@1
  char *v2; // r9@1
  char *v3; // r0@1
  const char *v4; // r2@2
  const char *v5; // t1@2
  int v6; // r5@3
  signed int v8; // r7@7
  int result; // r0@20
  int v14; // r3@21
  unsigned int v15; // r9@21
  int v16; // r11@21
  int v17; // r0@21
  int v18; // r7@21
  unsigned int v19; // r7@21
  unsigned int v20; // r4@21
  char v21; // [sp+30h] [bp-B0h]@1
  char *v22; // [sp+34h] [bp-ACh]@1
  char *v23; // [sp+38h] [bp-A8h]@1
  int v24; // [sp+3Ch] [bp-A4h]@1
  char v25; // [sp+40h] [bp-A0h]@6
  unsigned int v26; // [sp+44h] [bp-9Ch]@7
  int v27; // [sp+48h] [bp-98h]@18
  unsigned int v28; // [sp+4Ch] [bp-94h]@7
  int v29; // [sp+50h] [bp-90h]@7
  int v30; // [sp+54h] [bp-8Ch]@7
  signed int v31; // [sp+58h] [bp-88h]@7
  int v32; // [sp+60h] [bp-80h]@7
  signed int v33; // [sp+64h] [bp-7Ch]@7
  signed int v34; // [sp+6Ch] [bp-74h]@7
  signed int v35; // [sp+70h] [bp-70h]@7
  signed int v36; // [sp+78h] [bp-68h]@7
  signed int v37; // [sp+7Ch] [bp-64h]@7
  signed int v38; // [sp+84h] [bp-5Ch]@7
  signed int v39; // [sp+88h] [bp-58h]@7
  int v40; // [sp+94h] [bp-4Ch]@7
  int v41; // [sp+98h] [bp-48h]@16
  int v42; // [sp+9Ch] [bp-44h]@15
  int v43; // [sp+A4h] [bp-3Ch]@13
  int v44; // [sp+D0h] [bp-10h]@7
  int v45; // [sp+D4h] [bp-Ch]@7
  int v46; // [sp+D8h] [bp-8h]@7
  int v47; // [sp+E0h] [bp+0h]@3
  int v48; // [sp+120h] [bp+40h]@5
  int v49; // [sp+134h] [bp+54h]@19
  int v50; // [sp+14Ch] [bp+6Ch]@21
  int v51; // [sp+164h] [bp+84h]@1

  v1 = a1;
  v2 = &v21;
  v3 = off_8008[0];
  v22 = off_8008[0];
  v23 = off_800C;
  v24 = unk_8010;
  v51 = _stack_chk_guard;
  do
  {
    v5 = (const char *)*((_DWORD *)v2 + 1);
    v2 += 4;
    v4 = v5;
    if ( !v5 )
      goto LABEL_20;
    snprintf((char *)&v47, 0x40u, v4, 0);
    v3 = (char *)open((const char *)&v47, 2, 0);
    v6 = (int)v3;
  }
  while ( v3 == (char *)-1 );
  if ( (signed int)v3 < 0 )
    goto LABEL_20;
  v3 = (char *)(ioctl((int)v3, 0x4602u, &v48, v3 + 1) + 1);
  if ( !v3 )
    goto LABEL_20;
  _R4 = &v25;
  v3 = (char *)(ioctl(v6, 0x4600u, &v25) + 1);
  if ( !v3 )
    goto LABEL_20;
  v31 = 32;
  v8 = 0;
  v33 = 8;
  v34 = 8;
  v35 = 8;
  v37 = 8;
  v39 = 8;
  v36 = 16;
  v38 = 24;
  v44 = 0;
  v45 = 0;
  v46 = 0;
  v29 = 0;
  v30 = 0;
  v40 = 0;
  v32 = 0;
  v28 = 3 * v26;
  if ( ioctl(v6, 0x4601u, &v25) == -1 )
  {
    v28 = v26;
    _android_log_print(
      5,
      "[Gralloc-Warning]",
      "%s:%d FBIOPUT_VSCREENINFO failed, page flipping not supported fd: %d",
      "int init_frame_buffer_locked(private_module_t*)",
      257,
      v6);
  }
  else
  {
    v8 = 1;
  }
  if ( v28 < 2 * v26 )
  {
    v28 = v26;
    v8 = 0;
    _android_log_print(
      5,
      "[Gralloc-Warning]",
      "%s:%d page flipping not supported (yres_virtual=%d, requested=%d)",
      "int init_frame_buffer_locked(private_module_t*)",
      265,
      v26,
      2 * v26);
  }
  v3 = (char *)(ioctl(v6, 0x4600u, &v25) + 1);
  if ( !v3 )
    goto LABEL_20;
  if ( !v43 )
    _android_log_print(
      5,
      "[Gralloc-Warning]",
      "%s:%d fbdev pixclock is zero for fd: %d",
      "int init_frame_buffer_locked(private_module_t*)",
      287,
      v6);
  __asm { VLDR            S16, =25.4 }
  if ( v42 <= 0 || v41 <= 0 )
  {
    __asm
    {
      VLDR            S15, [R4]
      VMOV.F32        S13, #0.5
      VLDR            S5, [R4,#4]
      VLDR            S1, =160.0
      VCVT.F32.U32    S14, S15
      VCVT.F32.U32    S6, S5
      VMUL.F32        S0, S14, S16
      VMUL.F32        S7, S6, S16
      VDIV.F32        S2, S0, S1
      VDIV.F32        S8, S7, S1
      VADD.F32        S3, S2, S13
      VADD.F32        S9, S8, S13
      VCVTR.U32.F32   S4, S3
      VCVTR.U32.F32   S10, S9
      VSTR            S4, [R4,#0x5C]
      VSTR            S10, [R4,#0x58]
    }
  }
  __asm
  {
    VLDR            S11, [R4]
    VLDR            S0, [R4,#4]
    VLDR            S15, [R4,#0x5C]
    VCVT.F32.U32    S17, S11
    VCVT.F32.U32    S1, S0
    VCVT.F32.U32    S14, S15
    VMUL.F32        S12, S17, S16
    VMUL.F32        S2, S1, S16
    VLDR            S16, [R4,#0x58]
    VDIV.F32        S17, S12, S14
    VCVT.F32.U32    S13, S16
    VDIV.F32        S16, S2, S13
  }
  _android_log_print(
    4,
    "[Gralloc]",
    "using (fd=%d)\n"
    "id           = %s\n"
    "xres         = %d px\n"
    "yres         = %d px\n"
    "xres_virtual = %d px\n"
    "yres_virtual = %d px\n"
    "bpp          = %d\n"
    "r            = %2u:%u\n"
    "g            = %2u:%u\n"
    "b            = %2u:%u\n",
    v6,
    &v48,
    *(_DWORD *)&v25,
    v26,
    v27,
    v28,
    v31,
    v32,
    v33,
    v34,
    v35,
    v36,
    v37);
  __asm
  {
    VCVT.F64.F32    D16, S17
    VCVT.F64.F32    D17, S16
    VSTR            D16, [SP,#0x174+var_174]
    VSTR            D17, [SP,#0x174+var_164]
  }
  _android_log_print(
    4,
    "[Gralloc]",
    "width        = %d mm (%f dpi)\nheight       = %d mm (%f dpi)\nrefresh rate = %.2f Hz\n",
    v42);
  v3 = (char *)(ioctl(v6, 0x4602u, &v48) + 1);
  if ( !v3 || !v49 )
  {
LABEL_20:
    result = -*(_DWORD *)_errno(v3);
    goto LABEL_22;
  }
  *(_DWORD *)(v1 + 180) = v8;
  memcpy((void *)(v1 + 208), &v25, 0xA0u);
  memcpy((void *)(v1 + 368), &v48, 0x44u);
  v14 = v50;
  *(_DWORD *)(v1 + 444) = 1114636288;
  __asm
  {
    VSTR            S17, [R8,#0x1B4]
    VSTR            S16, [R8,#0x1B8]
    VMOV.I32        D8, #0
  }
  v15 = (v14 * v28 + 4095) & 0xFFFFF000;
  v16 = dup(v6);
  v17 = operator new(0xD0u);
  v18 = v17;
  *(_DWORD *)(v17 + 12) = -1;
  __asm { VSTR            D8, [R7,#0x94+var_7C] }
  *(_DWORD *)(v17 + 36) = 1;
  *(_DWORD *)(v17 + 16) = 51647890;
  *(_DWORD *)(v17 + 40) = v15;
  *(_DWORD *)(v17 + 48) = 0;
  *(_DWORD *)(v17 + 56) = 0;
  *(_DWORD *)(v17 + 60) = 0;
  *(_DWORD *)(v17 + 64) = getpid();
  *(_DWORD *)(v18 + 68) = 0;
  *(_DWORD *)(v18 + 72) = v16;
  __asm { VSTR            D8, [R7,#0x50] }
  *(_DWORD *)(v18 + 88) = 0;
  *(_DWORD *)(v18 + 92) = 0;
  *(_DWORD *)(v18 + 96) = 0;
  *(_DWORD *)(v18 + 100) = 0;
  *(_DWORD *)(v18 + 104) = 0;
  *(_DWORD *)(v18 + 108) = 0;
  *(_DWORD *)(v18 + 112) = 0;
  *(_DWORD *)(v18 + 116) = 0;
  *(_DWORD *)(v18 + 120) = 0;
  *(_DWORD *)(v18 + 124) = 0;
  *(_DWORD *)(v18 + 128) = 0;
  *(_DWORD *)(v18 + 132) = 0;
  *(_DWORD *)(v18 + 140) = 0;
  *(_DWORD *)(v18 + 160) = 0;
  *(_DWORD *)(v18 + 164) = 0;
  *(_DWORD *)(v18 + 168) = 0;
  *(_DWORD *)(v18 + 172) = 0;
  *(_DWORD *)(v18 + 176) = 0;
  *(_DWORD *)(v18 + 180) = 0;
  *(_DWORD *)(v18 + 184) = 0;
  *(_DWORD *)(v18 + 188) = 255;
  *(_DWORD *)(v18 + 192) = 0;
  *(_DWORD *)(v18 + 196) = 0;
  *(_DWORD *)(v18 + 200) = 0;
  *(_DWORD *)v18 = 12;
  *(_DWORD *)(v18 + 4) = 1;
  *(_DWORD *)(v18 + 8) = 48;
  *(_DWORD *)(v1 + 176) = v18;
  v19 = v28;
  v20 = v26;
  *(_DWORD *)(v1 + 188) = 0;
  *(_DWORD *)(v1 + 184) = v19 / v20;
  result = 0;
LABEL_22:
  if ( v51 != _stack_chk_guard )
    _stack_chk_fail(result);
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 1578: using guessed type int __fastcall _errno(_DWORD);
// 1614: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 8008: using guessed type char *off_8008[2];
// 800C: using guessed type char *;

//----- (00003148) --------------------------------------------------------
int __fastcall init_frame_buffer_locked(private_module_t *a1, int a2, int a3)
{
  int result; // r0@2

  if ( a1 )
  {
    if ( *((_DWORD *)a1 + 44) )
      result = 0;
    else
      result = sub_2DAC((int)a1);
  }
  else
  {
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d NULL pointer, module = %p",
      "int init_frame_buffer_locked(private_module_t*)",
      169,
      0,
      a3);
    result = -1;
  }
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00003190) --------------------------------------------------------
int __fastcall framebuffer_device_open(int a1, int a2, _DWORD *a3)
{
  _DWORD *v3; // r6@1
  int v4; // r5@1
  int result; // r0@3
  int v6; // r1@5
  int v7; // r2@5
  int v8; // r4@5
  int v9; // r7@7
  unsigned int v10; // r1@7
  unsigned int v11; // r3@7
  int v12; // r2@7
  int v13; // r5@7
  int v14; // [sp+14h] [bp-1Ch]@6

  v3 = a3;
  v4 = a1;
  if ( a1 && a3 )
  {
    result = (**(int (***)(void))(a1 + 20))();
    if ( result >= 0 )
    {
      pthread_mutex_lock((pthread_mutex_t *)(v4 + 192));
      v8 = init_frame_buffer_locked((private_module_t *)v4, v6, v7);
      pthread_mutex_unlock((pthread_mutex_t *)(v4 + 192));
      if ( v8 >= 0 )
      {
        v9 = operator new(0xB8u);
        memset((void *)v9, 0, 0xB8u);
        *(_DWORD *)(v9 + 8) = v4;
        *(_DWORD *)(v9 + 148) = compositionComplete;
        *(_DWORD *)(v9 + 60) = sub_2DA0;
        *(_DWORD *)v9 = 1213678676;
        result = 0;
        *(_DWORD *)(v9 + 136) = sub_2BCC;
        *(_DWORD *)(v9 + 144) = sub_2BF0;
        v10 = *(_DWORD *)(v4 + 232);
        v11 = *(_DWORD *)(v4 + 412);
        *(_DWORD *)(v9 + 64) = 0;
        *(_DWORD *)(v9 + 68) = *(_DWORD *)(v4 + 208);
        v12 = *(_DWORD *)(v4 + 212);
        *(_DWORD *)(v9 + 80) = 5;
        *(_DWORD *)(v9 + 72) = v12;
        *(_DWORD *)(v9 + 76) = v11 / (v10 >> 3);
        *(_DWORD *)(v9 + 84) = *(_DWORD *)(v4 + 436);
        *(_DWORD *)(v9 + 88) = *(_DWORD *)(v4 + 440);
        v13 = *(_DWORD *)(v4 + 444);
        *(_DWORD *)(v9 + 96) = 1;
        *(_DWORD *)(v9 + 100) = 1;
        *(_DWORD *)(v9 + 92) = v13;
        *v3 = v9;
      }
      else
      {
        (*(void (**)(void))(v14 + 60))();
        result = v8;
      }
    }
  }
  else
  {
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d NULL pointer, module = %p, device = %p",
      "int framebuffer_device_open(const hw_module_t*, const char*, hw_device_t**)",
      427,
      a1,
      a3);
    result = -1;
  }
  return result;
}
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2BCC: using guessed type int sub_2BCC();

//----- (00003290) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
signed int __fastcall gralloc_specific_fb_post(int a1, int a2)
{
  int v2; // r7@1
  int v3; // r6@1 OVERLAPPED
  const char *v4; // r2@4
  const char *v5; // r3@4
  const char *v6; // r1@4
  int v7; // r7@6
  signed int v8; // r2@7
  signed int v9; // r3@15
  int v10; // r5@30
  int v11; // r0@30
  int v12; // r1@30
  int v13; // r2@30
  int v14; // r3@30
  signed int v15; // r5@35
  __int64 v17; // [sp+0h] [bp-1A8h]@4
  char s; // [sp+8h] [bp-1A0h]@3
  char v19; // [sp+24h] [bp-184h]@3
  char v20; // [sp+40h] [bp-168h]@7
  signed int v21; // [sp+50h] [bp-158h]@7
  int v22; // [sp+60h] [bp-148h]@34
  int v23; // [sp+64h] [bp-144h]@34
  int v24; // [sp+68h] [bp-140h]@30
  int v25; // [sp+6Ch] [bp-13Ch]@30
  int v26; // [sp+70h] [bp-138h]@34
  int v27; // [sp+74h] [bp-134h]@34
  int v28; // [sp+78h] [bp-130h]@30
  int v29; // [sp+7Ch] [bp-12Ch]@30
  int v30; // [sp+88h] [bp-120h]@30
  int v31; // [sp+8Ch] [bp-11Ch]@30
  int v32; // [sp+ACh] [bp-FCh]@32
  int v33; // [sp+B0h] [bp-F8h]@30
  int v34; // [sp+B4h] [bp-F4h]@30
  int v35; // [sp+B8h] [bp-F0h]@30
  int v36; // [sp+BCh] [bp-ECh]@30
  int v37; // [sp+C0h] [bp-E8h]@30
  signed int v38; // [sp+C4h] [bp-E4h]@30
  int v39; // [sp+CCh] [bp-DCh]@30
  int v40; // [sp+D8h] [bp-D0h]@34
  int v41; // [sp+DCh] [bp-CCh]@34
  int v42; // [sp+148h] [bp-60h]@34
  int v43; // [sp+14Ch] [bp-5Ch]@34
  int v44; // [sp+150h] [bp-58h]@34
  int v45; // [sp+154h] [bp-54h]@34
  int v46; // [sp+158h] [bp-50h]@34
  int v47; // [sp+15Ch] [bp-4Ch]@34
  int v48; // [sp+160h] [bp-48h]@34
  int v49; // [sp+164h] [bp-44h]@34
  int fd; // [sp+188h] [bp-20h]@34
  int v51; // [sp+18Ch] [bp-1Ch]@34

  v2 = a2;
  v3 = open("/dev/graphics/ade", 2, 0);
  if ( v3 < 0 )
  {
    _android_log_print(
      6,
      "[Gralloc-ERROR]",
      "%s:%d open ADE device failed!! fd%d ",
      "int gralloc_specific_fb_post(framebuffer_device_t*, buffer_handle_t)",
      70,
      v3);
    return -1;
  }
  memset(&s, 0, 0x38u);
  v19 = 3;
  if ( ioctl(v3, 0xC0384D87, &s) )
  {
    LODWORD(v17) = 81;
    HIDWORD(v17) = v3;
    v4 = "%s:%d set top resource failed!! fd%d ";
    v5 = "int gralloc_specific_fb_post(framebuffer_device_t*, buffer_handle_t)";
    v6 = "[Gralloc-ERROR]";
LABEL_5:
    _android_log_print(6, v6, v4, v5, v17);
    close(v3);
    return -1;
  }
  memset(&v20, 0, 0x98u);
  v8 = *(_DWORD *)(v2 + 20);
  *(_DWORD *)&v20 = 6;
  v21 = 16711936;
  if ( v8 == 5 )
  {
    v9 = 4;
    goto LABEL_30;
  }
  if ( v8 > 5 )
  {
    if ( v8 == 20 )
    {
      v9 = 16;
      goto LABEL_30;
    }
    if ( v8 > 20 )
    {
      if ( v8 == 256 )
      {
        v9 = 21;
        goto LABEL_30;
      }
      if ( v8 == 260 )
      {
        v9 = 18;
        goto LABEL_30;
      }
    }
    else if ( v8 == 17 )
    {
      v9 = 22;
      goto LABEL_30;
    }
    goto LABEL_28;
  }
  if ( v8 == 2 )
  {
    v9 = 3;
    goto LABEL_30;
  }
  if ( v8 > 2 )
  {
    if ( v8 == 3 )
    {
      v9 = 8;
      goto LABEL_30;
    }
    if ( v8 == 4 )
    {
      v9 = 0;
      goto LABEL_30;
    }
    goto LABEL_28;
  }
  if ( v8 != 1 )
  {
LABEL_28:
    v9 = 800;
    goto LABEL_30;
  }
  v9 = 5;
LABEL_30:
  v10 = *(_DWORD *)(v2 + 88);
  v38 = v9;
  v11 = *(_DWORD *)(v2 + 92);
  v12 = *(_DWORD *)(v2 + 12);
  v13 = *(_DWORD *)(v2 + 32);
  v14 = *(_DWORD *)(v2 + 96);
  v24 = v10;
  v25 = v11;
  v28 = v10;
  v29 = v11;
  v30 = v10;
  v31 = v11;
  v39 = v12;
  v33 = v13;
  v34 = v10;
  v36 = v11;
  v37 = v11;
  v35 = v10;
  if ( !v14 )
    v14 = *(_DWORD *)(v2 + 116);
  v32 = v14;
  if ( ioctl(v3, 0xC0984D88, &v20) )
  {
    LODWORD(v17) = 113;
    HIDWORD(v17) = v3;
    v6 = "[Gralloc-ERROR]";
    v4 = "%s:%d set region info failed!! fd%d ";
    v5 = "int gralloc_specific_fb_post(framebuffer_device_t*, buffer_handle_t)";
    goto LABEL_5;
  }
  memset(&v40, 0, 0xB8u);
  v42 = v22;
  v43 = v23;
  v44 = v24;
  v45 = v25;
  v46 = v26;
  v47 = v27;
  v48 = v28;
  v49 = v29;
  v40 = 1;
  v41 = 3072;
  fd = -1;
  v51 = dword_81DC++;
  v7 = ioctl(v3, 0x40B84D89u, &v40);
  if ( v7 )
  {
    v15 = 131;
    v17 = *(_QWORD *)(&v3 - 1);
    v6 = "[Gralloc-ERROR]";
    v4 = "%s:%d commit failed!! fd%d ";
    v5 = "int gralloc_specific_fb_post(framebuffer_device_t*, buffer_handle_t)";
    goto LABEL_5;
  }
  if ( fd != -1 )
    close(fd);
  close(v3);
  return v7;
}
// 3290: variables would overlap: r6.4 and r5.8
// 13C8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 81DC: using guessed type int dword_81DC;

//----- (00003488) --------------------------------------------------------
int __fastcall gralloc_specific_convert_format(int result, int a2)
{
  if ( result == 34 )
  {
    if ( a2 & 0x20000 )
      result = 17;
  }
  return result;
}

//----- (00003498) --------------------------------------------------------
unsigned int *__fastcall gralloc_specific_calc_size_stride(int a1, int a2, int a3, int a4, unsigned int *a5, unsigned int *a6, int *a7)
{
  unsigned int v7; // r1@1
  unsigned int v8; // r1@3
  unsigned int *result; // r0@3

  v7 = a2 * a1;
  if ( !(a4 & 0x4000000) )
    v7 = (v7 + 15) & 0xFFFFFFF0;
  *a5 = a3 * v7;
  *a7 = v7;
  v8 = v7 / a1;
  result = a6;
  *a6 = v8;
  return result;
}

//----- (000034BC) --------------------------------------------------------
unsigned int *__fastcall gralloc_specific_calc_special_size(int a1, int a2, int a3, int a4, unsigned int a5, unsigned int *a6, unsigned int *a7)
{
  unsigned int *result; // r0@1
  unsigned int v8; // r3@1

  result = a7;
  v8 = a4 * a5;
  if ( a2 == 842094169 || a2 == 35 )
  {
    *a6 = (v8 + 63) & 0xFFFFFFC0;
    *a7 = (*a7 + 63) & 0xFFFFFFC0;
  }
  else
  {
    *a6 = v8;
  }
  return result;
}

//----- (000034EC) --------------------------------------------------------
signed int __fastcall gralloc_specific_select_heap(int a1, bool a2)
{
  return 1;
}

//----- (000034F0) --------------------------------------------------------
unsigned int __fastcall gralloc_specific_align(int a1, int a2)
{
  return (a2 + 0x1FFF) & 0xFFFFE000;
}

//----- (00003500) --------------------------------------------------------
unsigned int __fastcall gralloc_specific_change_ionflags_size(unsigned int result, int a2, unsigned int *a3, unsigned int *a4)
{
  unsigned int *v4; // r6@1
  unsigned int v5; // r4@1
  unsigned int *v6; // r7@1

  v4 = a3;
  v5 = *a3;
  v6 = a4;
  _R5 = *a4;
  if ( !(a2 & 0x1000000) )
  {
    result = gralloc_specific_align(
               result,
               ((*(_DWORD *)(*(_DWORD *)(result + 8) + 208) * (*(_DWORD *)(*(_DWORD *)(result + 8) + 232) >> 3) + 15) & 0xFFFFFFF0)
             * *(_DWORD *)(*(_DWORD *)(result + 8) + 212));
    if ( !result )
    {
      *v4 = v5 | 0x80000000;
      return result;
    }
    if ( _R5 > result )
    {
      result = _R5 - result * (_R5 / result);
      if ( !result )
        goto LABEL_10;
    }
    else
    {
      __asm
      {
        VMOV            S15, R0
        VMOV            S0, R5
        VLDR            D17, =0.86
        VCVT.F32.U32    S14, S15
        VCVT.F32.U32    S1, S0
        VDIV.F32        S2, S1, S14
        VCVT.F64.F32    D16, S2
        VCMPE.F64       D16, D17
        VMRS            APSR_nzcv, FPSCR
      }
      if ( !((unsigned __int8)(_NF ^ _VF) | _ZF) )
      {
        _R5 = result;
LABEL_10:
        *v4 = v5;
        *v6 = _R5;
        return result;
      }
    }
    v5 |= 0x80000000;
    goto LABEL_10;
  }
  return result;
}

//----- (00003588) --------------------------------------------------------
int __fastcall gralloc_specific_set_yuvinfo(int result, int a2)
{
  signed int v2; // r3@3

  if ( result & 0x40000000 )
  {
    if ( 8 * result >= 0 )
      v2 = 1;
    else
      v2 = 2;
    *(_DWORD *)(a2 + 68) = v2;
  }
  return result;
}

//----- (00003598) --------------------------------------------------------
int __fastcall gralloc_specific_get_default_ionheap(private_module_t *a1)
{
  return 0;
}

//----- (0000359C) --------------------------------------------------------
int __fastcall gralloc_specific_clear_buffer(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r1@1

  v2 = a2;
  memset(*(void **)(a2 + 48), 0, *(_DWORD *)(a2 + 40));
  v3 = *(_DWORD *)(v2 + 12);
  return j_j_ion_sync_fd();
}

//----- (000035B8) --------------------------------------------------------
signed int __fastcall sub_35B8(int a1, int a2, unsigned int a3, unsigned int a4)
{
  unsigned int v4; // r5@1
  unsigned int v5; // r7@1
  int v6; // r10@1
  int v7; // r4@1
  int v8; // r11@2
  unsigned int v9; // r8@7
  int v10; // r9@7
  int v11; // r0@8
  int v12; // r2@9
  int v13; // r1@10
  signed int result; // r0@10
  int v15; // r3@19
  int v16; // r2@19
  int v17; // r0@19
  int v18; // r1@19
  int v19; // r2@37
  int v20; // r0@39
  int v21; // r1@39
  int v22; // r3@39
  unsigned int v23; // r1@40
  unsigned int v24; // r0@40
  int v25; // r1@42
  int v26; // r6@45
  char v27; // r1@45
  int v29; // r0@50
  unsigned int v35; // r0@51
  int v36; // [sp+4h] [bp-34h]@58
  int v37; // [sp+8h] [bp-30h]@6
  int v38; // [sp+Ch] [bp-2Ch]@22
  int v39; // [sp+10h] [bp-28h]@8

  v4 = a4;
  v5 = a3;
  v6 = a2;
  v7 = a1;
  if ( a3 >= a4 )
    goto LABEL_58;
  v8 = 0;
  do
  {
    v9 = v5 + 1;
    v10 = *(_BYTE *)(v6 + (v5 ^ 3));
    if ( !(v10 & 0x80) )
    {
      sub_3E30(v7, 13, &v39);
      v11 = 4 * v10;
      if ( v10 & 0x40 )
        v12 = -4 - (v11 & 0xFC) + v39;
      else
        v12 = v11 + v39 + 4;
      v39 = v12;
LABEL_23:
      sub_3E60(v7, 13, v12);
      ++v5;
      continue;
    }
    v13 = v10 & 0xF0;
    result = 9;
    if ( v13 > 159 )
    {
      if ( v13 > 191 )
      {
        if ( v13 == 192 )
        {
          switch ( v10 )
          {
            case 199:
              if ( !*(_BYTE *)(v6 + (v9 ^ 3)) || (unsigned int)*(_BYTE *)(v6 + (v9 ^ 3)) >= 0x10 )
                return 9;
              goto LABEL_55;
            case 192:
            case 193:
            case 194:
            case 195:
            case 196:
            case 197:
              v18 = 3;
              v16 = ((v10 & 7) + 1) | 0xA0000;
              v17 = v7;
              goto LABEL_33;
            case 200:
            case 201:
              v23 = *(_BYTE *)(v6 + (v9 ^ 3));
              v24 = v23 >> 4;
              if ( v10 == 200 )
                v24 = (v23 >> 4) | 0x10;
              v25 = v23 & 0xF;
              if ( (signed int)(v24 + v25) > 31 )
                return 9;
              v19 = (v25 + 1) | (v24 << 16);
              v20 = v7;
              v21 = 1;
              goto LABEL_53;
            case 198:
              v35 = *(_BYTE *)(v6 + (v9 ^ 3));
              if ( (signed int)((v35 & 0xF) + (v35 >> 4)) > 15 )
                return 9;
              v19 = ((v35 & 0xF) + 1) | (v35 >> 4 << 16);
              v20 = v7;
              v21 = 3;
LABEL_53:
              v22 = 5;
LABEL_54:
              sub_39A0(v20, v21, v19, v22);
              goto LABEL_55;
            default:
              return 9;
          }
          return 9;
        }
        if ( v13 != 208 )
          return result;
        if ( v10 & 8 )
          return 9;
        v18 = 1;
        v16 = ((v10 & 7) + 1) | 0x80000;
        v17 = v7;
LABEL_33:
        v15 = 5;
      }
      else
      {
        if ( v13 != 160 )
        {
          if ( v13 != 176 )
            return result;
          result = 9;
          switch ( v10 )
          {
            case 177:
              if ( v9 >= v4 )
                return 9;
              v19 = *(_BYTE *)(v6 + (v9 ^ 3));
              result = 9;
              if ( !*(_BYTE *)(v6 + (v9 ^ 3)) || v19 & 0xF0 )
                return result;
              v20 = v7;
              v21 = 0;
              v22 = 0;
              goto LABEL_54;
            case 178:
              if ( v9 >= v4 )
                return 9;
              v5 += 2;
              v26 = 0;
              v27 = 0;
              break;
            case 179:
              v22 = 1;
              v29 = *(_BYTE *)(v6 + (v9 ^ 3));
              _R1 = v29 << 12;
              __asm { UXTB16.W        R1, R1 }
              v19 = ((v29 & 0xF) + 1) | _R1;
              v20 = v7;
              v21 = 1;
              goto LABEL_54;
            case 176:
              goto LABEL_57;
            case 180:
            case 181:
            case 182:
            case 183:
              return result;
            default:
              v18 = 1;
              v15 = 1;
              v16 = ((v10 & 7) + 1) | 0x80000;
              v17 = v7;
              goto LABEL_34;
          }
          while ( 1 )
          {
            v26 |= (*(_BYTE *)(v6 + ((v5 - 1) ^ 3)) & 0x7F) << v27;
            if ( !(*(_BYTE *)(v6 + ((v5 - 1) ^ 3)) & 0x80) )
              break;
            _CF = v5 >= v4;
            v27 += 7;
            result = 9;
            ++v5;
            if ( _CF )
              return result;
          }
          sub_3E30(v7, 13, &v37);
          v37 += 4 * v26 + 516;
          sub_3E60(v7, 13, v37);
          continue;
        }
        v15 = 0;
        v16 = ((16 << ((*(_BYTE *)(v6 + (v5 ^ 3)) & 7) + 1)) - 16) | (*(_BYTE *)(v6 + (v5 ^ 3)) << 11) & 0x4000;
        v17 = v7;
        v18 = 0;
      }
LABEL_34:
      sub_39A0(v17, v18, v16, v15);
      ++v5;
      continue;
    }
    if ( v13 != 128 )
    {
      if ( v13 != 144 )
        return result;
      if ( (v10 & 0xF | 2) == 15 )
        return 9;
      sub_3E30(v7, v10 & 0xF, &v38);
      v12 = v38;
      goto LABEL_23;
    }
    if ( v9 >= v4 || !((unsigned __int16)((_WORD)v10 << 12) | 16 * *(_BYTE *)(v6 + ((v5 + 1) ^ 3))) )
      return 9;
    sub_39A0(v7, 0, (unsigned __int16)((_WORD)v10 << 12) | 16 * *(_BYTE *)(v6 + (v9 ^ 3)), 0);
    v8 |= (((_WORD)v10 << 12) & 0x8000u) >> 15;
LABEL_55:
    v5 += 2;
  }
  while ( v5 < v4 );
LABEL_57:
  if ( v8 & 1 )
    return 8;
LABEL_58:
  sub_3E30(v7, 14, &v36);
  sub_3E60(v7, 15, v36);
  return 8;
}

//----- (000038FC) --------------------------------------------------------
signed int __fastcall sub_38FC(int a1, int a2, unsigned int a3, int a4, int *a5)
{
  int v5; // r5@1
  int v6; // r4@1
  signed int result; // r0@2
  int v8; // r2@4
  int v9; // r0@4
  int v10; // r1@4
  __int64 v11; // r2@10
  int v12; // r1@10

  v5 = a3;
  v6 = a1;
  switch ( a2 )
  {
    case 0:
      result = 2;
      if ( a3 > 0xF || a4 )
        return result;
      v8 = *a5;
      v9 = v6;
      v10 = v5;
      goto LABEL_14;
    case 1:
      if ( a4 == 5 )
      {
        if ( a3 <= 0x1F )
          goto LABEL_21;
        return 2;
      }
      if ( a4 != 1 || a3 > 0xF )
        return 2;
      sub_3F4C(a1);
LABEL_21:
      v11 = *(_QWORD *)a5;
      v12 = v5 + 256;
LABEL_22:
      result = sub_3ED4(v6, v12, v11, SHIDWORD(v11));
LABEL_23:
      if ( result )
        result = 2;
      return result;
    case 3:
      result = 2;
      if ( a3 > 0x1F || a4 != 5 )
        return result;
      v11 = *(_QWORD *)a5;
      v12 = v5 + 112;
      goto LABEL_22;
    case 4:
      result = 2;
      if ( a3 > 3 || a4 )
        return result;
      v8 = *a5;
      v10 = v5 + 192;
      v9 = v6;
LABEL_14:
      result = sub_3E60(v9, v10, v8);
      goto LABEL_23;
    default:
      sub_3CD4(
        (int)"_Unwind_VRS_Result _Unwind_VRS_Set(_Unwind_Context *, _Unwind_VRS_RegClass, uint32_t, _Unwind_VRS_DataRepre"
             "sentation, void *)",
        831,
        (int)"unsupported register class");
      return result;
  }
}

//----- (000039A0) --------------------------------------------------------
signed int __fastcall sub_39A0(int a1, int a2, unsigned int a3, int a4)
{
  int v4; // r5@1
  int v5; // r7@1
  unsigned int v6; // r6@1
  int v7; // r8@1
  int v8; // r4@4
  unsigned int v9; // r7@4
  int *v10; // r0@6
  signed int v11; // r0@6
  signed int v12; // r1@6
  signed int v13; // r2@6
  signed int result; // r0@14
  unsigned int v15; // r4@18
  unsigned int v16; // r6@18
  int v17; // r0@19
  int v18; // r2@19
  int v19; // r0@19
  int v20; // r2@22
  int v21; // [sp+8h] [bp-38h]@19
  int v22; // [sp+Ch] [bp-34h]@19
  int v23; // [sp+14h] [bp-2Ch]@16
  int v24; // [sp+18h] [bp-28h]@6
  int *v25; // [sp+1Ch] [bp-24h]@3

  v4 = a2;
  v5 = a4;
  v6 = a3;
  v7 = a1;
  switch ( a2 )
  {
    case 0:
    case 4:
      if ( a4 || sub_3E30(a1, 13, &v25) )
        return 2;
      v8 = 0;
      v9 = 0;
      do
      {
        if ( (1 << v9) & v6 )
        {
          v10 = v25;
          ++v25;
          v24 = *v10;
          v11 = sub_38FC(v7, v4, v9, 0, &v24);
          v12 = 0;
          v13 = 0;
          if ( v9 == 13 )
            v12 = 1;
          if ( !v4 )
            v13 = 1;
          if ( v11 )
            return 2;
          v8 |= v13 & v12;
        }
        ++v9;
      }
      while ( v9 < 0x10 );
      if ( v8 & 1 )
        return 0;
      v20 = (int)v25;
      goto LABEL_28;
    case 1:
    case 3:
      if ( (a4 | 4) != 5 || sub_3E30(a1, 13, &v23) )
        return 2;
      if ( !(_WORD)v6 )
        goto LABEL_21;
      v15 = v6 >> 16;
      v16 = (v6 >> 16) + v6;
      break;
    default:
      sub_3CD4(
        (int)"_Unwind_VRS_Result _Unwind_VRS_Pop(_Unwind_Context *, _Unwind_VRS_RegClass, uint32_t, _Unwind_VRS_DataRepresentation)",
        965,
        (int)"unsupported register class");
      return result;
  }
  do
  {
    v17 = v23;
    v23 += 4;
    v18 = *(_DWORD *)v17;
    v23 = v17 + 8;
    v19 = *(_DWORD *)(v17 + 4);
    v21 = v18;
    v22 = v19;
    if ( sub_38FC(v7, v4, v15, v5, &v21) )
      return 2;
    ++v15;
  }
  while ( v15 < v16 );
LABEL_21:
  if ( v5 == 1 )
  {
    v20 = v23 + 4;
    v23 += 4;
  }
  else
  {
    v20 = v23;
  }
LABEL_28:
  result = sub_3E60(v7, 13, v20);
  if ( result )
    result = 2;
  return result;
}

//----- (00003AC4) --------------------------------------------------------
signed int __fastcall sub_3AC4(int a1, int a2, int a3)
{
  int v3; // r0@1
  int v4; // r1@1
  unsigned int *v5; // r12@1
  int v6; // r3@1
  unsigned int v7; // r3@4
  unsigned int v8; // r2@4

  v3 = a2;
  v4 = a3;
  v5 = *(unsigned int **)(v3 + 76);
  v6 = (*v5 >> 24) & 0xF;
  if ( v6 )
  {
    if ( v6 != 1 && v6 != 3 )
      return 9;
    v7 = 4 * ((*v5 >> 16) & 0xFF) + 4;
    v8 = 2;
  }
  else
  {
    v8 = 1;
    v7 = 4;
  }
  if ( !v5 || !(*(_BYTE *)(v3 + 80) & 1) && *(unsigned int *)((char *)v5 + v7) )
    return 9;
  return sub_35B8(v4, (int)v5, v8, v7);
}

//----- (00003B18) --------------------------------------------------------
void sub_3B18()
{
  JUMPOUT(&loc_3ACC);
}

//----- (00003B20) --------------------------------------------------------
void sub_3B20()
{
  JUMPOUT(&loc_3ACC);
}

//----- (00003BBC) --------------------------------------------------------
signed int __fastcall sub_3BBC(int a1, int a2, char a3)
{
  int v3; // r4@1
  char v4; // r10@1
  signed int i; // r6@1
  signed int v6; // r7@3
  int v7; // r0@8
  int (__fastcall *v8)(signed int, int, char *); // r3@11
  int v9; // r0@12
  int v11; // [sp+0h] [bp-4B0h]@17
  int v12; // [sp+4h] [bp-4ACh]@10
  int (__fastcall *v13)(signed int, int, char *); // [sp+10h] [bp-4A0h]@11
  int v14; // [sp+18h] [bp-498h]@12
  int v15; // [sp+24h] [bp-48Ch]@12
  int v16; // [sp+2Ch] [bp-484h]@10
  char v17; // [sp+30h] [bp-480h]@1

  v3 = a2;
  v4 = a3;
  sub_3DE0((int)&v17);
  for ( i = 1; ; --i )
  {
    v6 = 1;
    if ( v4 & 1 )
    {
      v6 = 2;
      if ( !i )
      {
        sub_3E60((int)&v17, -1, *(_DWORD *)(v3 + 16));
        v4 = 0;
      }
    }
    v7 = sub_3F0C((int)&v17);
    if ( !v7 )
      break;
    if ( v7 < 0 )
      return 2;
    sub_3E30((int)&v17, -2, &v16);
    if ( sub_3F14((int)&v17, (int)&v12) )
      return 2;
    v8 = v13;
    if ( v13 )
    {
      *(_DWORD *)(v3 + 72) = v12;
      *(_DWORD *)(v3 + 76) = v15;
      *(_DWORD *)(v3 + 80) = v14;
      v9 = v8(v6, v3, &v17);
      if ( v9 == 7 )
      {
        sub_3E30((int)&v17, -1, &v11);
        *(_DWORD *)(v3 + 16) = v11;
        sub_3F34((int)&v17);
        return 2;
      }
      if ( v9 == 9 )
        abort();
      if ( v9 != 8 )
        return 2;
      if ( v16 == *(_DWORD *)(v3 + 32) )
        sub_3CD4(
          (int)"_Unwind_Reason_Code unwind_phase2(unw_context_t *, _Unwind_Exception *, bool)",
          642,
          (int)"during phase1 personality function said it would stop here, but now in phase2 it did not stop here");
    }
  }
  return 5;
}

//----- (00003CD4) --------------------------------------------------------
void __fastcall sub_3CD4(int a1, int a2, int a3)
{
  fprintf((FILE *)stderr, "libunwind: %s %s:%d - %s\n", a1, "external/libcxxabi/src/Unwind/Unwind-EHABI.cpp", a2, a3);
  abort();
}

//----- (00003D58) --------------------------------------------------------
int __fastcall sub_3D58(int a1, int a2, int a3, int a4, int a5)
{
  int v5; // r4@0
  int v6; // r5@0
  int v7; // r6@0
  int v8; // r7@0
  int v9; // r8@0
  int v10; // r9@0
  int v11; // r10@0
  int v12; // r11@0
  int v13; // r12@0
  int v14; // lr@0

  *(_DWORD *)a1 = a1;
  *(_DWORD *)(a1 + 4) = a2;
  *(_DWORD *)(a1 + 8) = a3;
  *(_DWORD *)(a1 + 12) = a4;
  *(_DWORD *)(a1 + 16) = v5;
  *(_DWORD *)(a1 + 20) = v6;
  *(_DWORD *)(a1 + 24) = v7;
  *(_DWORD *)(a1 + 28) = v8;
  *(_DWORD *)(a1 + 32) = v9;
  *(_DWORD *)(a1 + 36) = v10;
  *(_DWORD *)(a1 + 40) = v11;
  *(_DWORD *)(a1 + 44) = v12;
  *(_DWORD *)(a1 + 48) = v13;
  *(_DWORD *)(a1 + 52) = &a5;
  *(_DWORD *)(a1 + 56) = v14;
  *(_DWORD *)(a1 + 60) = v14;
  return 0;
}

//----- (00003D70) --------------------------------------------------------
int __fastcall sub_3D70(int _R0)
{
  int result; // r0@1

  __asm { VSTMIA          R0, {D0-D15} }
  return result;
}

//----- (00003D78) --------------------------------------------------------
int __fastcall sub_3D78(int _R0)
{
  int result; // r0@1

  __asm { VSTMIA          R0, {D0-D15} }
  return result;
}

//----- (00003D80) --------------------------------------------------------
int __fastcall sub_3D80(int _R0)
{
  int result; // r0@1

  __asm { VSTMIA          R0, {D16-D31} }
  return result;
}

//----- (00003D88) --------------------------------------------------------
void sub_3D88()
{
  __asm
  {
    STCL            p1, c0, [R0],#8
    STCL            p1, c1, [R0],#8
    STCL            p1, c2, [R0],#8
    STCL            p1, c3, [R0],#8
    STCL            p1, c4, [R0],#8
    STCL            p1, c5, [R0],#8
    STCL            p1, c6, [R0],#8
    STCL            p1, c7, [R0],#8
    STCL            p1, c8, [R0],#8
    STCL            p1, c9, [R0],#8
    STCL            p1, c10, [R0],#8
    STCL            p1, c11, [R0],#8
    STCL            p1, c12, [R0],#8
    STCL            p1, c13, [R0],#8
    STCL            p1, c14, [R0],#8
    STCL            p1, c15, [R0],#8
  }
}

//----- (00003DCC) --------------------------------------------------------
void sub_3DCC()
{
  __asm
  {
    STC2            p1, c8, [R0],#4
    STC2            p1, c9, [R0],#4
    STC2            p1, c10, [R0],#4
    STC2            p1, c11, [R0],#4
  }
}

//----- (00003DE0) --------------------------------------------------------
int __fastcall sub_3DE0(int a1)
{
  int v1; // r4@1

  v1 = a1;
  *(_DWORD *)a1 = &off_7D3C;
  *(_DWORD *)(a1 + 4) = &unk_81E0;
  *(_BYTE *)(a1 + 76) = 0;
  *(_DWORD *)(a1 + 72) = 0;
  _aeabi_memcpy(a1 + 8);
  _aeabi_memset(v1 + 80, 450, 0);
  sub_4364(v1, 0);
  return 0;
}
// 1644: using guessed type int __fastcall _aeabi_memcpy(_DWORD);
// 1650: using guessed type int __fastcall _aeabi_memset(_DWORD, _DWORD, _DWORD);
// 7D3C: using guessed type void *;

//----- (00003E30) --------------------------------------------------------
signed int __fastcall sub_3E30(int a1, int a2, _DWORD *a3)
{
  int v3; // r6@1
  _DWORD *v4; // r4@1
  int v5; // r5@1
  signed int result; // r0@2

  v3 = a1;
  v4 = a3;
  v5 = a2;
  if ( (*(int (**)(void))(*(_DWORD *)a1 + 8))() == 1 )
  {
    *v4 = (*(int (__fastcall **)(int, int))(*(_DWORD *)v3 + 12))(v3, v5);
    result = 0;
  }
  else
  {
    result = -6542;
  }
  return result;
}

//----- (00003E60) --------------------------------------------------------
signed int __fastcall sub_3E60(int a1, int a2, int a3)
{
  int v3; // r4@1
  int v4; // r6@1
  int v5; // r5@1
  signed int v6; // r5@3

  v3 = a1;
  v4 = a3;
  v5 = a2;
  if ( (*(int (**)(void))(*(_DWORD *)a1 + 8))() == 1 )
  {
    (*(void (__fastcall **)(int, int, int))(*(_DWORD *)v3 + 16))(v3, v5, v4);
    if ( v5 == -1 )
    {
      v6 = 0;
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)v3 + 52))(v3, 0);
    }
    else
    {
      v6 = 0;
    }
  }
  else
  {
    v6 = -6542;
  }
  return v6;
}

//----- (00003EA4) --------------------------------------------------------
signed int __fastcall sub_3EA4(int a1, int a2, _QWORD *a3)
{
  int v3; // r6@1
  _QWORD *v4; // r4@1
  int v5; // r5@1
  __int64 v6; // r0@2
  signed int result; // r0@2

  v3 = a1;
  v4 = a3;
  v5 = a2;
  if ( (*(int (**)(void))(*(_DWORD *)a1 + 20))() == 1 )
  {
    LODWORD(v6) = (*(int (__fastcall **)(int, int))(*(_DWORD *)v3 + 24))(v3, v5);
    *v4 = v6;
    result = 0;
  }
  else
  {
    result = -6542;
  }
  return result;
}

//----- (00003ED4) --------------------------------------------------------
signed int __fastcall sub_3ED4(int a1, int a2, int a3, int a4)
{
  int v4; // r7@1
  int v5; // r5@1
  int v6; // r6@1
  int v7; // r8@1
  signed int result; // r0@2

  v4 = a1;
  v5 = a3;
  v6 = a2;
  v7 = a4;
  if ( (*(int (**)(void))(*(_DWORD *)a1 + 20))() == 1 )
  {
    (*(void (__fastcall **)(int, int, int, int))(*(_DWORD *)v4 + 28))(v4, v6, v5, v7);
    result = 0;
  }
  else
  {
    result = -6542;
  }
  return result;
}

//----- (00003F0C) --------------------------------------------------------
int __fastcall sub_3F0C(int a1)
{
  return (*(int (**)(void))(*(_DWORD *)a1 + 32))();
}

//----- (00003F14) --------------------------------------------------------
signed int __fastcall sub_3F14(int a1, int a2)
{
  int v2; // r4@1
  signed int result; // r0@1

  v2 = a2;
  (*(void (**)(void))(*(_DWORD *)a1 + 36))();
  result = 0;
  if ( !*(_DWORD *)(v2 + 4) )
    result = -6549;
  return result;
}

//----- (00003F34) --------------------------------------------------------
signed int __fastcall sub_3F34(int a1)
{
  (*(void (**)(void))(*(_DWORD *)a1 + 40))();
  return -6540;
}

//----- (00003F4C) --------------------------------------------------------
int __fastcall sub_3F4C(int a1)
{
  return (*(int (**)(void))(*(_DWORD *)a1 + 60))();
}

//----- (00003F5C) --------------------------------------------------------
int __fastcall sub_3F5C(int a1, int a2)
{
  signed int v2; // r2@1
  bool v3; // zf@1
  signed int v4; // r0@1
  unsigned int v5; // r1@1

  v2 = 0;
  v3 = (a2 & 0xFFFFFFFC) == 192;
  v4 = 0;
  v5 = a2 - 16;
  if ( v3 )
    v4 = 1;
  if ( v5 > 0xFFFFFFED )
    v2 = 1;
  return v4 | v2;
}

//----- (00003F80) --------------------------------------------------------
int __fastcall sub_3F80(int a1, signed int a2)
{
  signed int v2; // r5@1
  int v3; // r4@1
  int v4; // r0@7

  v2 = a2;
  v3 = a1;
  if ( a2 >= -1 )
  {
    if ( a2 > 13 )
    {
      if ( a2 == 14 )
      {
        v4 = a1 + 64;
        return *(_DWORD *)v4;
      }
      if ( a2 != 15 )
        goto LABEL_12;
    }
    else if ( a2 != -1 )
    {
      if ( a2 != 13 )
        goto LABEL_12;
LABEL_7:
      v4 = a1 + 60;
      return *(_DWORD *)v4;
    }
    v4 = a1 + 68;
    return *(_DWORD *)v4;
  }
  if ( a2 == -2 )
    goto LABEL_7;
LABEL_12:
  if ( (unsigned int)a2 > 0xC )
  {
    if ( (a2 & 0xFFFFFFFC) != 192 )
      sub_43C0(
        (int)"uint32_t libunwind::Registers_arm::getRegister(int)",
        (int)"external/libcxxabi/src/Unwind/Registers.hpp",
        1452,
        (int)"unsupported arm register");
    if ( !*(_BYTE *)(a1 + 76) )
    {
      *(_BYTE *)(a1 + 76) = 1;
      sub_3DCC();
    }
    v4 = v3 + 4 * v2 - 296;
  }
  else
  {
    v4 = a1 + 4 * a2 + 8;
  }
  return *(_DWORD *)v4;
}

//----- (0000401C) --------------------------------------------------------
int __fastcall sub_401C(int result, signed int a2, int a3)
{
  signed int v3; // r6@1
  int v4; // r4@1
  int v5; // r5@1

  v3 = a2;
  v4 = a3;
  v5 = result;
  if ( a2 >= -1 )
  {
    if ( a2 > 13 )
    {
      if ( a2 == 14 )
      {
        *(_DWORD *)(result + 64) = a3;
        return result;
      }
      if ( a2 != 15 )
        goto LABEL_12;
    }
    else if ( a2 != -1 )
    {
      if ( a2 != 13 )
        goto LABEL_12;
LABEL_7:
      *(_DWORD *)(result + 60) = a3;
      return result;
    }
    *(_DWORD *)(result + 68) = a3;
    return result;
  }
  if ( a2 == -2 )
    goto LABEL_7;
LABEL_12:
  if ( (unsigned int)a2 > 0xC )
  {
    if ( (a2 & 0xFFFFFFFC) != 192 )
      sub_43C0(
        (int)"void libunwind::Registers_arm::setRegister(int, uint32_t)",
        (int)"external/libcxxabi/src/Unwind/Registers.hpp",
        1471,
        (int)"unsupported arm register");
    if ( !*(_BYTE *)(result + 76) )
    {
      *(_BYTE *)(result + 76) = 1;
      sub_3DCC();
    }
    result = v5 + 4 * v3;
    *(_DWORD *)(result - 296) = v4;
  }
  else
  {
    result += 4 * a2;
    *(_DWORD *)(result + 8) = a3;
  }
  return result;
}

//----- (000040B4) --------------------------------------------------------
int __fastcall sub_40B4(int a1, int a2)
{
  signed int v2; // r2@1
  bool v3; // zf@1
  signed int v4; // r0@1
  unsigned int v5; // r1@1

  v2 = 0;
  v3 = (a2 & 0xFFFFFFF0) == 112;
  v4 = 0;
  v5 = a2 & 0xFFFFFFE0;
  if ( v3 )
    v4 = 1;
  if ( v5 == 256 )
    v2 = 1;
  return v4 | v2;
}

//----- (000040D8) --------------------------------------------------------
__int64 __fastcall sub_40D8(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r5@1
  unsigned int v4; // r0@1
  int v5; // r0@5
  int v6; // r0@11

  v2 = a2;
  v3 = a1;
  v4 = a2 & 0xFFFFFFF0;
  if ( (a2 & 0xFFFFFFF0) == 112 )
  {
    if ( !*(_BYTE *)(v3 + 75) )
    {
      *(_BYTE *)(v3 + 75) = 1;
      sub_3D88();
    }
    v5 = v3 + 8 * v2 - 552;
  }
  else if ( v4 == 272 )
  {
    if ( !*(_BYTE *)(v3 + 74) )
    {
      *(_BYTE *)(v3 + 74) = 1;
      sub_3D80(v3 + 216);
    }
    v5 = v3 + 8 * v2 - 1960;
  }
  else
  {
    if ( v4 != 256 )
      sub_43C0(
        (int)"unw_fpreg_t libunwind::Registers_arm::getFloatRegister(int)",
        (int)"external/libcxxabi/src/Unwind/Registers.hpp",
        1673,
        (int)"Unknown ARM float register");
    if ( !*(_BYTE *)(v3 + 73) )
    {
      *(_BYTE *)(v3 + 73) = 1;
      v6 = v3 + 80;
      if ( *(_BYTE *)(v3 + 72) )
        sub_3D78(v6);
      else
        sub_3D70(v6);
    }
    v5 = v3 + 8 * v2 - 1968;
  }
  return *(_QWORD *)v5;
}

//----- (00004188) --------------------------------------------------------
int __fastcall sub_4188(int a1, int a2, int a3, int a4)
{
  int v4; // r6@1
  int v5; // r7@1
  unsigned int v6; // r0@1
  int v7; // r5@1
  int v8; // r4@1
  int result; // r0@5
  int v10; // r1@5
  int v11; // r0@11

  v4 = a2;
  v5 = a1;
  v6 = a2 & 0xFFFFFFF0;
  v7 = a4;
  v8 = a3;
  if ( (a2 & 0xFFFFFFF0) == 112 )
  {
    if ( !*(_BYTE *)(v5 + 75) )
    {
      *(_BYTE *)(v5 + 75) = 1;
      sub_3D88();
    }
    result = v5 + 8 * v4;
    *(_DWORD *)(result - 548) = v7;
    LOWORD(v10) = -552;
  }
  else if ( v6 == 272 )
  {
    if ( !*(_BYTE *)(v5 + 74) )
    {
      *(_BYTE *)(v5 + 74) = 1;
      sub_3D80(v5 + 216);
    }
    result = v5 + 8 * v4;
    *(_DWORD *)(result - 1828) = v7;
    LOWORD(v10) = -1832;
  }
  else
  {
    if ( v6 != 256 )
      sub_43C0(
        (int)"void libunwind::Registers_arm::setFloatRegister(int, unw_fpreg_t)",
        (int)"external/libcxxabi/src/Unwind/Registers.hpp",
        1700,
        (int)"Unknown ARM float register");
    if ( !*(_BYTE *)(v5 + 73) )
    {
      *(_BYTE *)(v5 + 73) = 1;
      v11 = v5 + 80;
      if ( *(_BYTE *)(v5 + 72) )
        sub_3D78(v11);
      else
        sub_3D70(v11);
    }
    result = v5 + 8 * v4;
    *(_DWORD *)(result - 1964) = v7;
    LOWORD(v10) = -1968;
  }
  HIWORD(v10) = -1;
  *(_DWORD *)(result + v10) = v8;
  return result;
}

//----- (0000425C) --------------------------------------------------------
signed int __fastcall sub_425C(int a1)
{
  int v1; // r4@1
  signed int result; // r0@3
  void (__fastcall *v3)(int, signed int, int); // r5@5
  int v4; // r0@5

  v1 = a1;
  if ( *(_BYTE *)(a1 + 528)
    || ((*(void (__fastcall **)(int, signed int))(*(_DWORD *)a1 + 52))(a1, 1), *(_BYTE *)(v1 + 528)) )
  {
    result = 0;
  }
  else
  {
    if ( *(_DWORD *)(v1 + 504) )
    {
      v3 = *(void (__fastcall **)(int, signed int, int))(*(_DWORD *)v1 + 16);
      v4 = (*(int (__fastcall **)(int, signed int))(*(_DWORD *)v1 + 12))(v1, -2);
      v3(v1, -2, *(_DWORD *)(v1 + 504) + v4);
    }
    result = 1;
  }
  return result;
}

//----- (000042A8) --------------------------------------------------------
int __fastcall sub_42A8(int a1, int a2)
{
  int v2; // r3@1
  int v3; // r4@1
  int v4; // r5@1
  int v5; // r12@1
  int v6; // lr@1
  int v7; // r4@1
  int v8; // r2@1
  int v9; // r3@1
  int v10; // r5@1
  int result; // r0@1

  v2 = *(_DWORD *)(a1 + 504);
  v3 = *(_DWORD *)(a1 + 496);
  v4 = *(_DWORD *)(a1 + 500);
  v5 = *(_DWORD *)(a1 + 488);
  v6 = *(_DWORD *)(a1 + 492);
  *(_DWORD *)(a2 + 20) = *(_DWORD *)(a1 + 508);
  *(_DWORD *)(a2 + 16) = v2;
  *(_DWORD *)(a2 + 12) = v4;
  *(_DWORD *)(a2 + 8) = v3;
  v7 = a2 + 24;
  *(_DWORD *)a2 = v5;
  *(_DWORD *)(a2 + 4) = v6;
  v8 = *(_DWORD *)(a1 + 512);
  v9 = *(_DWORD *)(a1 + 516);
  v10 = *(_DWORD *)(a1 + 520);
  result = *(_DWORD *)(a1 + 524);
  *(_DWORD *)(a2 + 36) = result;
  *(_DWORD *)v7 = v8;
  *(_DWORD *)(v7 + 4) = v9;
  *(_DWORD *)(v7 + 8) = v10;
  return result;
}

//----- (000042E8) --------------------------------------------------------
void __fastcall sub_42E8(int a1)
{
  sub_43F4(a1 + 8);
  sub_4DA0();
}

//----- (00004300) --------------------------------------------------------
int __fastcall sub_4300(int a1)
{
  return *(_BYTE *)(a1 + 529);
}

//----- (00004308) --------------------------------------------------------
signed int __fastcall sub_4308(int a1, int a2, int a3, _DWORD *a4)
{
  int v4; // r6@1
  int v5; // r5@1
  _DWORD *v6; // r4@1
  int v7; // r7@1
  signed int result; // r0@3
  int v9; // [sp+10h] [bp-20h]@2
  int v10; // [sp+14h] [bp-1Ch]@3

  v4 = a2;
  v5 = a3;
  v6 = a4;
  v7 = (*(int (**)(void))(*(_DWORD *)a1 + 12))();
  if ( dladdr() && v9 )
  {
    _snprintf_chk(v4, v5, 0, -1);
    *v6 = v7 - v10;
    result = 1;
  }
  else
  {
    result = 0;
  }
  return result;
}
// 165C: using guessed type int dladdr(void);
// 1668: using guessed type int __fastcall _snprintf_chk(_DWORD, _DWORD, _DWORD, _DWORD);

//----- (00004364) --------------------------------------------------------
int __fastcall sub_4364(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r6@1
  unsigned int v4; // r5@1
  int result; // r0@5
  int v6; // [sp+4h] [bp-1Ch]@3
  int v7; // [sp+8h] [bp-18h]@3
  int v8; // [sp+Ch] [bp-14h]@1

  v2 = a1;
  v3 = a2;
  v4 = (*(int (**)(void))(*(_DWORD *)a1 + 12))() & 0xFFFFFFFE;
  v8 = 0;
  if ( v3 )
    --v4;
  v6 = _gnu_Unwind_Find_exidx(v4, &v8);
  v7 = v8;
  if ( !v6 || !v8 || (result = ((int (__fastcall *)(int, unsigned int, int *))sub_4444)(v2, v4, &v6)) == 0 )
  {
    result = 1;
    *(_BYTE *)(v2 + 528) = 1;
  }
  return result;
}
// 1674: using guessed type int __fastcall _gnu_Unwind_Find_exidx(_DWORD, _DWORD);
// 4444: using guessed type int sub_4444();

//----- (000043B0) --------------------------------------------------------
const char *__fastcall sub_43B0(int a1, signed int a2)
{
  const char *result; // r0@2
  signed int v3; // r0@3
  int *v4; // r1@3

  if ( a2 > 255 )
  {
    switch ( a2 )
    {
      case 256:
        v3 = -6888;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 257:
        v3 = -6885;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 258:
        v3 = -6882;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 259:
        v3 = -6879;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 260:
        v3 = -6876;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 261:
        v3 = -6873;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 262:
        v3 = -6870;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 263:
        v3 = -6867;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 264:
        v3 = -6864;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 265:
        v3 = -6861;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 266:
        v3 = -6858;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 267:
        v3 = -6854;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 268:
        v3 = -6850;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 269:
        v3 = -6846;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 270:
        v3 = -6842;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 271:
        v3 = -6838;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 272:
        v3 = -6834;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 273:
        v3 = -6830;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 274:
        v3 = -6826;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 275:
        v3 = -6822;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 276:
        v3 = -6818;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 277:
        v3 = -6814;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 278:
        v3 = -6810;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 279:
        v3 = -6806;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 280:
        v3 = -6802;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 281:
        v3 = -6798;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 282:
        v3 = -6794;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 283:
        v3 = -6790;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 284:
        v3 = -6786;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 285:
        v3 = -6782;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 286:
        v3 = -6778;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 287:
        v3 = -6774;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      default:
def_4720:
        v3 = -6770;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
    }
  }
  else
  {
    result = "pc";
    switch ( a2 + 2 )
    {
      case 0:
      case 15:
        v3 = -7051;
        v4 = &GLOBAL_OFFSET_TABLE_;
        return (char *)v4 + v3;
      default:
        goto def_4720;
      case 1:
      case 17:
        return result;
      case 2:
        v3 = -7048;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 3:
        v3 = -7045;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 4:
        v3 = -7042;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 5:
        v3 = -7039;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 6:
        v3 = -7036;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 7:
        v3 = -7033;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 8:
        v3 = -7030;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 9:
        v3 = -7027;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 10:
        v3 = -7024;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 11:
        v3 = -7021;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 12:
        v3 = -7018;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 13:
        v3 = -7014;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 14:
        v3 = -7010;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 16:
        v3 = -7054;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 66:
        v3 = -7006;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 67:
        v3 = -7003;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 68:
        v3 = -7000;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 69:
        v3 = -6997;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 70:
        v3 = -6994;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 71:
        v3 = -6991;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 72:
        v3 = -6988;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 73:
        v3 = -6985;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 74:
        v3 = -6982;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 75:
        v3 = -6979;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 76:
        v3 = -6976;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 77:
        v3 = -6972;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 78:
        v3 = -6968;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 79:
        v3 = -6964;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 80:
        v3 = -6960;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 81:
        v3 = -6956;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 82:
        v3 = -6952;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 83:
        v3 = -6948;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 84:
        v3 = -6944;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 85:
        v3 = -6940;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 86:
        v3 = -6936;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 87:
        v3 = -6932;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 88:
        v3 = -6928;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 89:
        v3 = -6924;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 90:
        v3 = -6920;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 91:
        v3 = -6916;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 92:
        v3 = -6912;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 93:
        v3 = -6908;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 94:
        v3 = -6904;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 95:
        v3 = -6900;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 96:
        v3 = -6896;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
      case 97:
        v3 = -6892;
        v4 = &GLOBAL_OFFSET_TABLE_;
        break;
    }
  }
  return (char *)v4 + v3;
}
// 7EF4: using guessed type int GLOBAL_OFFSET_TABLE_;

//----- (000043B8) --------------------------------------------------------
int __fastcall sub_43B8(int result)
{
  *(_BYTE *)(result + 72) = 1;
  return result;
}

//----- (000043C0) --------------------------------------------------------
void __fastcall sub_43C0(int a1, int a2, int a3, int a4)
{
  fprintf((FILE *)stderr, "libunwind: %s %s:%d - %s\n", a1, a2, a3, a4);
  abort();
}

//----- (000043F4) --------------------------------------------------------
int __fastcall sub_43F4(int a1)
{
  int v1; // r4@1
  int v2; // r0@2
  int result; // r0@9

  v1 = a1;
  if ( *(_BYTE *)(a1 + 65) )
  {
    v2 = a1 + 72;
    if ( *(_BYTE *)(v1 + 64) )
      sub_4CC8(v2);
    else
      sub_4CC0(v2);
  }
  if ( *(_BYTE *)(v1 + 66) )
    sub_4CD0(v1 + 208);
  if ( *(_BYTE *)(v1 + 67) )
    sub_4CD8((_DWORD *)(v1 + 336));
  result = *(_BYTE *)(v1 + 68);
  if ( *(_BYTE *)(v1 + 68) )
    result = sub_4DB0((_DWORD *)(v1 + 464));
  return result;
}

//----- (000045D4) --------------------------------------------------------
int __fastcall sub_45D4(int result, int a2, int a3, _DWORD *a4, int a5, int a6, int a7, _DWORD *a8)
{
  unsigned int v8; // r4@1
  unsigned int v9; // r5@2
  int v10; // r6@3

  v8 = a5 - a2;
  while ( 1 )
  {
    v9 = v8;
    if ( !v8 )
      break;
    v10 = a2 + (v8 >> 1);
    v8 >>= 1;
    if ( *a8 >= *a4 + 8 * v10 + (2 * *(_DWORD *)(*a4 + 8 * v10) & 0x80000000 | *(_DWORD *)(*a4 + 8 * v10)) )
    {
      v8 = v9 - 1 - v8;
      a2 = v10 + 1;
    }
  }
  *(_DWORD *)result = a2;
  *(_DWORD *)(result + 4) = a3;
  *(_DWORD *)(result + 8) = a4;
  return result;
}

//----- (00004CC0) --------------------------------------------------------
int __fastcall sub_4CC0(int _R0)
{
  int result; // r0@1

  __asm { VLDMIA          R0, {D0-D15} }
  return result;
}

//----- (00004CC8) --------------------------------------------------------
int __fastcall sub_4CC8(int _R0)
{
  int result; // r0@1

  __asm { VLDMIA          R0, {D0-D15} }
  return result;
}

//----- (00004CD0) --------------------------------------------------------
int __fastcall sub_4CD0(int _R0)
{
  int result; // r0@1

  __asm { VLDMIA          R0, {D16-D31} }
  return result;
}

//----- (00004CD8) --------------------------------------------------------
int __fastcall sub_4CD8(_DWORD *a1)
{
  int *v5; // r0@1
  int result; // r0@1

  _T1 = *a1;
  v5 = a1 + 2;
  __asm { LDCL            p1, c0, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c1, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c2, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c3, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c4, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c5, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c6, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c7, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c8, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c9, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c10, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c11, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c12, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c13, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c14, [R0],#8 }
  _T1 = *v5;
  result = (int)(v5 + 2);
  __asm { LDCL            p1, c15, [R0],#8 }
  return result;
}

//----- (00004D1C) --------------------------------------------------------
int __fastcall sub_4D1C(_DWORD *a1)
{
  int *v5; // r0@1
  int result; // r0@1

  _T1 = *a1;
  v5 = a1 + 1;
  __asm { LDC2            p1, c8, [R0],#4 }
  _T1 = *v5;
  ++v5;
  __asm { LDC2            p1, c9, [R0],#4 }
  _T1 = *v5;
  ++v5;
  __asm { LDC2            p1, c10, [R0],#4 }
  _T1 = *v5;
  result = (int)(v5 + 1);
  __asm { LDC2            p1, c11, [R0],#4 }
  return result;
}

//----- (00004D60) --------------------------------------------------------
void *j_j_memset(void *s, int c, size_t n)
{
  return j_memset(s, c, n);
}

//----- (00004D64) --------------------------------------------------------
void *j_memset(void *s, int c, size_t n)
{
  return memset(s, c, n);
}

//----- (00004D70) --------------------------------------------------------
int j_j_ion_sync_fd()
{
  return j_ion_sync_fd();
}

//----- (00004D74) --------------------------------------------------------
int j_ion_sync_fd()
{
  return ion_sync_fd();
}
// 15A8: using guessed type int ion_sync_fd(void);

//----- (00004D80) --------------------------------------------------------
int __fastcall j_j_j__Z24gralloc_backend_cache_opP16private_handle_tij(int a1, int a2, int a3)
{
  return j_gralloc_backend_cache_op(a1, a2, a3);
}

//----- (00004D84) --------------------------------------------------------
int __fastcall j_gralloc_backend_cache_op(int a1, int a2, int a3)
{
  return gralloc_backend_cache_op(a1, a2, a3);
}

//----- (00004D90) --------------------------------------------------------
int j_j_ion_invalidate_fd()
{
  return j_ion_invalidate_fd();
}

//----- (00004D94) --------------------------------------------------------
int j_ion_invalidate_fd()
{
  return ion_invalidate_fd();
}
// 15C0: using guessed type int ion_invalidate_fd(void);

//----- (00004DA0) --------------------------------------------------------
void sub_4DA0()
{
  sub_4DA4();
}

//----- (00004DA4) --------------------------------------------------------
void sub_4DA4()
{
  JUMPOUT(sub_4CAC);
}
// 4CAC: using guessed type int sub_4CAC();

//----- (00004DB0) --------------------------------------------------------
int __fastcall sub_4DB0(_DWORD *a1)
{
  return sub_4DB4(a1);
}

//----- (00004DB4) --------------------------------------------------------
int __fastcall sub_4DB4(_DWORD *a1)
{
  return sub_4D1C(a1);
}

// ALL OK, 117 function(s) have been successfully decompiled
